<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"futuquant.mjs.html":{"id":"futuquant.mjs.html","title":"Source: futuquant.mjs","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result Source: futuquant.mjs import bunyan from 'bunyan'; import bunyanDebugStream from 'bunyan-debug-stream'; import Socket from './socket'; const sleep = async time =&gt; new Promise((resolve) =&gt; { setTimeout(resolve, time); }); // Common /** * 协议返回值 * RetType 定义协议请求返回值 请求失败情况，除网络超时外，其它具体原因参见各协议定义的retMsg字段 RetType_Succeed = 0; //成功 RetType_Failed = -1; //失败 RetType_TimeOut = -100; //超时 RetType_Unknown = -400; //未知结果 * @typedef {number} RetType */ /** * 请求包标识，包的唯一标识，用于回放攻击的识别和保护 * PacketID 用于唯一标识一次请求 serailNO 由请求方自定义填入包头，为防回放攻击要求自增，否则新的请求将被忽略 * @typedef {object} PacketID * @property {number} connID 当前TCP连接的连接ID，一条连接的唯一标识，InitConnect协议会返回 * @property {number} serialNo 包头中的包自增序列号 */ // Qot_Common /** * 行情市场 * QotMarket定义一支证券所属的行情市场分类 QotMarket_HK_Future 港股期货，目前仅支持 999010(恒指当月期货)、999011(恒指下月期货) QotMarket_US_Option 美股期权，牛牛客户端可以查看行情，API 后续支持 QotMarket_Unknown = 0; //未知市场 QotMarket_HK_Security = 1; //港股 QotMarket_HK_Future = 2; //港期货(目前是恒指的当月、下月期货行情) QotMarket_US_Security = 11; //美股 QotMarket_US_Option = 12; //美期权,暂时不支持期权 QotMarket_CNSH_Security = 21; //沪股 QotMarket_CNSZ_Security = 22; //深股 * * @typedef {number} QotMarket */ /** * 股票类型 * SecurityType_Unknown = 0; //未知 SecurityType_Bond = 1; //债券 SecurityType_Bwrt = 2; //一揽子权证 SecurityType_Eqty = 3; //正股 SecurityType_Trust = 4; //信托,基金 SecurityType_Warrant = 5; //涡轮 SecurityType_Index = 6; //指数 SecurityType_Plate = 7; //板块 SecurityType_Drvt = 8; //期权 SecurityType_PlateSet = 9; //板块集 * @typedef {number} SecurityType */ /** * 板块集合的类型 * Qot_GetPlateSet 请求参数类型 PlateSetType_All = 0; //所有板块 PlateSetType_Industry = 1; //行业板块 PlateSetType_Region = 2; //地域板块,港美股市场的地域分类数据暂为空 PlateSetType_Concept = 3; //概念板块 * @typedef {number} PlateSetType */ /** * 窝轮子类型 * WarrantType_Unknown = 0; //未知 WarrantType_Buy = 1; //认购 WarrantType_Sell = 2; //认沽 WarrantType_Bull = 3; //牛 WarrantType_Bear = 4; //熊 * @typedef {number} WarrantType */ /** * 行情市场状态 * QotMarketState_None = 0; // 无交易,美股未开盘 QotMarketState_Auction = 1; // 竞价 QotMarketState_WaitingOpen = 2; // 早盘前等待开盘 QotMarketState_Morning = 3; // 早盘 QotMarketState_Rest = 4; // 午间休市 QotMarketState_Afternoon = 5; // 午盘 QotMarketState_Closed = 6; // 收盘 QotMarketState_PreMarketBegin = 8; // 盘前 QotMarketState_PreMarketEnd = 9; // 盘前结束 QotMarketState_AfterHoursBegin = 10; // 盘后 QotMarketState_AfterHoursEnd = 11; // 盘后结束 QotMarketState_NightOpen = 13; // 夜市开盘 QotMarketState_NightEnd = 14; // 夜市收盘 QotMarketState_FutureDayOpen = 15; // 期指日市开盘 QotMarketState_FutureDayBreak = 16; // 期指日市休市 QotMarketState_FutureDayClose = 17; // 期指日市收盘 QotMarketState_FutureDayWaitForOpen = 18; // 期指日市等待开盘 QotMarketState_HkCas = 19; // 盘后竞价,港股市场增加CAS机制对应的市场状态 * @typedef {number} QotMarketState */ /** * 复权类型 * RehabType_None = 0; //不复权 RehabType_Forward = 1; //前复权 RehabType_Backward = 2; //后复权 * @typedef {number} RehabType */ /** * K线类型，枚举值兼容旧协议定义，新类型季K,年K,3分K暂时没有支持历史K线 * KLType_Unknown = 0; //未知 KLType_1Min = 1; //1分K KLType_Day = 2; //日K KLType_Week = 3; //周K KLType_Month = 4; //月K KLType_Year = 5; //年K KLType_5Min = 6; //5分K KLType_15Min = 7; //15分K KLType_30Min = 8; //30分K KLType_60Min = 9; //60分K KLType_3Min = 10; //3分K KLType_Quarter = 11; //季K * @typedef {number} KLType */ /** * 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 * KLFields_None = 0; // KLFields_High = 1; //最高价 KLFields_Open = 2; //开盘价 KLFields_Low = 4; //最低价 KLFields_Close = 8; //收盘价 KLFields_LastClose = 16; //昨收价 KLFields_Volume = 32; //成交量 KLFields_Turnover = 64; //成交额 KLFields_TurnoverRate = 128; //换手率 KLFields_PE = 256; //市盈率 KLFields_ChangeRate = 512; //涨跌幅 * @typedef {number} KLFields */ /** * 行情定阅类型，订阅类型，枚举值兼容旧协议定义 * SubType_None = 0; SubType_Basic = 1; //基础报价 SubType_OrderBook = 2; //摆盘 SubType_Ticker = 4; //逐笔 SubType_RT = 5; //分时 SubType_KL_Day = 6; //日K SubType_KL_5Min = 7; //5分K SubType_KL_15Min = 8; //15分K SubType_KL_30Min = 9; //30分K SubType_KL_60Min = 10; //60分K SubType_KL_1Min = 11; //1分K SubType_KL_Week = 12; //周K SubType_KL_Month = 13; //月K SubType_Broker = 14; //经纪队列 SubType_KL_Qurater = 15; //季K SubType_KL_Year = 16; //年K SubType_KL_3Min = 17; //3分K * @typedef {number} SubType */ /** * 逐笔方向 * TickerDirection_Unknown = 0; //未知 TickerDirection_Bid = 1; //外盘 TickerDirection_Ask = 2; //内盘 TickerDirection_Neutral = 3; //中性盘 * @typedef {number} TickerDirection */ /** * 股票，两个字段确定一支股票 * @typedef {object} Security * @property {QotMarket} market QotMarket,股票市场 * @property {string} code 股票代码 */ /** * K线数据点 * @typedef {object} KLine * @property {string} time 时间戳字符串 * @property {boolean} isBlank 是否是空内容的点,若为ture则只有时间信息 * @property {number} [highPrice] 最高价 * @property {number} [openPrice] 开盘价 * @property {number} [lowPrice] 最低价 * @property {number} [closePrice] 收盘价 * @property {number} [lastClosePrice] 昨收价 * @property {number} [volume] 成交量 * @property {number} [turnover] 成交额 * @property {number} [turnoverRate] 换手率 * @property {number} [pe] 市盈率 * @property {number} [changeRate] 涨跌幅 */ /** * 基础报价 * @typedef {object} BasicQot * @property {security} security 股票 * @property {boolean} isSuspended 是否停牌 * @property {string} listTime 上市日期字符串 * @property {number} priceSpread 价差 * @property {string} updateTime 更新时间字符串 * @property {number} highPrice 最高价 * @property {number} openPrice 开盘价 * @property {number} lowPrice 最低价 * @property {number} curPrice 最新价 * @property {number} lastClosePrice 昨收价 * @property {number} volume 成交量 * @property {number} turnover 成交额 * @property {number} turnoverRate 换手率 * @property {number} amplitude 振幅 */ /** * 分时数据点 * @typedef {object} TimeShare * @property {string} time 时间字符串 * @property {number} minute 距离0点过了多少分钟 * @property {boolean} isBlank 是否是空内容的点,若为ture则只有时间信息 * @property {number} [price] 当前价 * @property {number} [lastClosePrice] 昨收价 * @property {number} [avgPrice] 均价 * @property {number} [volume] 成交量 * @property {number} [turnover] 成交额 */ /** * 证券基本静态信息 * @typedef {object} SecurityStaticBasic * @property {security} security 股票 * @property {number} id 股票ID * @property {number} lotSize 每手数量 * @property {SecurityType} secType Qot_Common.SecurityType,股票类型 * @property {string} name 股票名字 * @property {string} listTime 上市时间字符串 */ /** * 窝轮额外股票静态信息 * @typedef {object} WarrantStaticExData * @property {WarrantType} type Qot_Common.WarrantType,涡轮类型 * @property {Security} owner 所属正股 */ /** * 证券静态信息 * @typedef {object} SecurityStaticInfo * @property {SecurityStaticBasic} basic 基本股票静态信息 * @property {WarrantStaticExData} [warrantExData] 窝轮额外股票静态信息 */ /** * 买卖经纪摆盘 * @typedef {object} Broker * @property {number} id 经纪ID * @property {string} name 经纪名称 * @property {number} pos 经纪档位 */ /** * 逐笔成交 * @typedef {object} Ticker * @property {string} time 时间字符串 * @property {number} sequence 唯一标识 * @property {TickerDirection} dir TickerDirection, 买卖方向 * @property {number} price 价格 * @property {number} volume 成交量 * @property {number} turnover 成交额 * @property {number} [recvTime] 收到推送数据的本地时间戳，用于定位延迟 */ /** * 买卖十档摆盘 * @typedef {object} OrderBook * @property {number} price 委托价格 * @property {number} volume 委托数量 * @property {number} orederCount 委托订单个数 */ /** * 单个定阅类型信息 * @typedef {object} SubInfo * @property {SubType} subType Qot_Common.SubType,订阅类型 * @property {Security[]} securityList 订阅该类型行情的股票 */ /** * 单条连接定阅信息 * 一条连接重复定阅其它连接已经订阅过的，不会额外消耗订阅额度 * @typedef ConnSubInfo * @property {SubInfo[]} subInfoList 该连接订阅信息 * @property {number} usedQuota 该连接已经使用的订阅额度 * @property {boolean} isOwnConnData 用于区分是否是自己连接的数据 */ // Trd_Common /** * 交易环境 * TrdEnv_Simulate = 0; //仿真环境(模拟环境) TrdEnv_Real = 1; //真实环境 * @typedef {number} TrdEnv */ /** * 交易市场，是大的市场，不是具体品种 * TrdMarket_Unknown = 0; //未知市场 TrdMarket_HK = 1; //香港市场 TrdMarket_US = 2; //美国市场 TrdMarket_CN = 3; //大陆市场 TrdMarket_HKCC = 4; //香港A股通市场 * @typedef {number} TrdMarket */ /** * 交易方向，客户端下单只传Buy或Sell即可，SellShort是服务器返回有此方向，BuyBack目前不存在，但也不排除服务器会传 * TrdSide_Unknown = 0; //未知方向 TrdSide_Buy = 1; //买入 TrdSide_Sell = 2; //卖出 TrdSide_SellShort = 3; //卖空 TrdSide_BuyBack = 4; //买回 * @typedef {number} TrdSide */ /** * 订单类型 * OrderType_Unknown = 0; //未知类型 OrderType_Normal = 1; //普通订单(港股的增强限价单、A股的限价委托、美股的限价单) OrderType_Market = 2; //市价订单(目前仅美股) OrderType_AbsoluteLimit = 5; //绝对限价订单(目前仅港股)，只有价格完全匹配才成交，比如你下价格为5元的买单，卖单价格必须也要是5元才能成交，低于5元也不能成交。卖出同理 OrderType_Auction = 6; //竞价订单(目前仅港股)，A股的早盘竞价订单类型不变还是OrderType_Normal OrderType_AuctionLimit = 7; //竞价限价订单(目前仅港股) OrderType_SpecialLimit = 8; //特别限价订单(目前仅港股)，成交规则同OrderType_AbsoluteLimit，且如果当前没有对手可成交，不能立即成交，交易所自动撤销订单 * @typedef {number} OrderType */ /** * 订单状态 * OrderStatus_Unsubmitted = 0; //未提交 OrderStatus_Unknown = -1; //未知状态 OrderStatus_WaitingSubmit = 1; //等待提交 OrderStatus_Submitting = 2; //提交中 OrderStatus_SubmitFailed = 3; //提交失败，下单失败 OrderStatus_TimeOut = 4; //处理超时，结果未知 OrderStatus_Submitted = 5; //已提交，等待成交 OrderStatus_Filled_Part = 10; //部分成交 OrderStatus_Filled_All = 11; //全部已成 OrderStatus_Cancelling_Part = 12; //正在撤单_部分(部分已成交，正在撤销剩余部分) OrderStatus_Cancelling_All = 13; //正在撤单_全部 OrderStatus_Cancelled_Part = 14; //部分成交，剩余部分已撤单 OrderStatus_Cancelled_All = 15; //全部已撤单，无成交 OrderStatus_Failed = 21; //下单失败，服务拒绝 OrderStatus_Disabled = 22; //已失效 OrderStatus_Deleted = 23; //已删除，无成交的订单才能删除 * @typedef {number} OrderStatus */ /** * 持仓方向类型 * PositionSide_Long = 0; //多仓，默认情况是多仓 PositionSide_Unknown = -1; //未知方向 PositionSide_Short = 1; //空仓 * @typedef {number} PositionSide */ /** * 修改订单的操作类型，港股支持全部操作，美股目前仅支持ModifyOrderOp_Normal和ModifyOrderOp_Cancel * ModifyOrderOp_Unknown = 0; //未知操作 ModifyOrderOp_Normal = 1; //修改订单的价格、数量等，即以前的改单 ModifyOrderOp_Cancel = 2; //撤单 ModifyOrderOp_Disable = 3; //失效 ModifyOrderOp_Enable = 4; //生效 ModifyOrderOp_Delete = 5; //删除 * @typedef {number} ModifyOrderOp */ /** * 需要再次确认订单的原因枚举 * ReconfirmOrderReason_Unknown = 0; //未知原因 ReconfirmOrderReason_QtyTooLarge = 1; //订单数量太大，确认继续下单并否拆分成多个小订单 ReconfirmOrderReason_PriceAbnormal = 2; //价格异常，偏离当前价太大，确认继续下单 * @typedef {number} ReconfirmOrderReason */ /** * 交易协议公共参数头 * @typedef {object} TrdHeader * @property {TrdEnv} trdEnv 交易环境, 参见TrdEnv的枚举定义 * @property {number} accID 业务账号, 业务账号与交易环境、市场权限需要匹配，否则会返回错误 * @property {TrdMarket} trdMarket 交易市场, 参见TrdMarket的枚举定义 */ /** * 交易业务账户结构 * @typedef {object} TrdAcc * @property {TrdEnv} trdEnv 交易环境, 参见TrdEnv的枚举定义 * @property {number} accID 业务账号, 业务账号与交易环境、市场权限需要匹配，否则会返回错误 * @property {TrdMarket} trdMarketAuthList 业务账户支持的交易市场权限，即此账户能交易那些市场, 可拥有多个交易市场权限，目前仅单个，取值参见TrdMarket的枚举定义 */ /** * 账户资金结构 * @typedef {object} Funds * @property {number} power 购买力，3位精度(A股2位)，下同 * @property {number} totalAssets 资产净值 * @property {number} cash 现金 * @property {number} marketVal 证券市值 * @property {number} frozenCash 冻结金额 * @property {number} debtCash 欠款金额 * @property {number} avlWithdrawalCash 可提金额 */ /** * 账户持仓结构 * @typedef {object} Position * @property {number} positionID 持仓ID，一条持仓的唯一标识 * @property {PositionSide} positionSide 持仓方向，参见PositionSide的枚举定义 * @property {string} code 代码 * @property {string} name 名称 * @property {number} qty 持有数量，2位精度，期权单位是&quot;张&quot;，下同 * @property {number} canSellQty 可卖数量 * @property {number} price 市价，3位精度(A股2位) * @property {number} [costPrice] 成本价，无精度限制，如果没传，代表此时此值无效 * @property {number} val 市值，3位精度(A股2位) * @property {number} plVal 盈亏金额，3位精度(A股2位) * @property {number} [plRatio] 盈亏比例，无精度限制，如果没传，代表此时此值无效 * @property {number} [td_plVal] 今日盈亏金额，3位精度(A股2位)，下同 * @property {number} [td_trdVal] 今日交易额 * @property {number} [td_buyVal] 今日买入总额 * @property {number} [td_buyQty] 今日买入总量 * @property {number} [td_sellVal] 今日卖出总额 * @property {number} [td_sellQty] 今日卖出总量 */ /** * 订单结构 * @typedef {object} Order * @property {TrdSide} trdSide 交易方向, 参见TrdSide的枚举定义 * @property {OrderType} orderType 订单类型, 参见OrderType的枚举定义 * @property {OrderStatus} orderStatus 订单状态, 参见OrderStatus的枚举定义 * @property {number} orderID 订单号 * @property {string} orderIDEx 扩展订单号 * @property {string} code 代码 * @property {string} name 名称 * @property {number} qty 订单数量，2位精度，期权单位是&quot;张&quot; * @property {number} [price] 订单价格，3位精度(A股2位) * @property {string} createTime 创建时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传 * @property {string} updateTime 最后更新时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传 * @property {number} [fillQty] 成交数量，2位精度，期权单位是&quot;张&quot; * @property {number} [fillAvgPrice] 成交均价，无精度限制 * @property {string} [lastErrMsg] 最后的错误描述，如果有错误，会有此描述最后一次错误的原因，无错误为空 */ /** * 成交结构 * @typedef {object} OrderFill * @property {number} trdSide 交易方向, 参见TrdSide的枚举定义 * @property {number} fillID 成交号 * @property {string} fillIDEx 扩展成交号 * @property {number} [orderID] 订单号 * @property {string} [orderIDEx] 扩展订单号 * @property {string} code 代码 * @property {string} name 名称 * @property {number} qty 订单数量，2位精度，期权单位是&quot;张&quot; * @property {number} price 订单价格，3位精度(A股2位) * @property {string} createTime 创建时间（成交时间），严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传 * @property {number} [counterBrokerID] 对手经纪号，港股有效 * @property {string} [counterBrokerName] 对手经纪名称，港股有效 */ /** * 过滤条件，条件组合是&quot;与&quot;不是&quot;或&quot;，用于获取订单、成交、持仓等时二次过滤 * @typedef {object} TrdFilterConditions * @property {string[]} codeList 代码过滤，只返回包含这些代码的数据，没传不过滤 * @property {number[]} idList ID主键过滤，只返回包含这些ID的数据，没传不过滤，订单是orderID、成交是fillID、持仓是positionID * @property {string} [beginTime] 开始时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传，对持仓无效，拉历史数据必须填 * @property {string} [endTime] 结束时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传，对持仓无效，拉历史数据必须填 */ /** * 封装FutuQuant底层协议模块 */ class FutuQuant { /** * Creates an instance of FutuQuant. * @param {object} params 初始化参数 * @param {string} params.ip FutuOpenD服务IP * @param {number} params.port FutuOpenD服务端口 * @param {number} params.userID 牛牛号 * @param {TrdMarket} [params.market] 市场环境 * @param {object} [logger] 日志对象，若不传入，则使用bunyan.createLogger创建 * @memberof FutuQuant */ constructor(params, logger) { if (typeof params !== 'object') throw new Error('传入参数类型错误'); const { ip, port, userID, market, } = params; if (!ip) throw new Error('必须指定FutuOpenD服务的ip'); if (!port) throw new Error('必须指定FutuOpenD服务的port'); if (!userID) throw new Error('必须指定FutuOpenD服务的牛牛号'); this.logger = logger; this.market = market || 1; // 当前市场环境 if (this.logger) { ['debug', 'info', 'warn', 'error', 'fatal', 'trace'].forEach((key) =&gt; { if (typeof this.logger[key] !== 'function') this.logger = null; }); } if (!this.logger) { this.logger = bunyan.createLogger({ name: 'sys', streams: [{ level: 'debug', type: 'raw', serializers: bunyanDebugStream.serializers, stream: bunyanDebugStream({ forceColor: true }), }], }); } /** * 实例化的socket对象 * @type {Socket} */ this.socket = new Socket(ip, port, this.logger); // 所有行情拉取接口 /** * 牛牛号 * @type {number} */ this.userID = userID; /** * 是否已经初始化 * @type {boolean} */ this.inited = false; /** * 交易公共头部信息 * @type {TrdHeader} */ this.trdHeader = null; /** * 保持心跳定时器 * @type {number} */ this.timerKeepLive = null; } /** * 初始化连接，InitConnect.proto协议返回对象 * @typedef InitConnectResponse * @property {number} serverVer FutuOpenD的版本号 * @property {number} loginUserID FutuOpenD登陆的牛牛用户ID * @property {number} connID 此连接的连接ID，连接的唯一标识 * @property {string} connAESKey 此连接后续AES加密通信的Key，固定为16字节长字符串 * @property {number} keepAliveInterval 心跳保活间隔 */ /** * InitConnect.proto - 1001初始化连接 * nodejs版本会根据返回的keepAliveInterval字段自动保持心跳连接，不再需要手动调用ft.keepLive()方法。 请求其它协议前必须等InitConnect协议先完成 若FutuOpenD配置了加密， “connAESKey”将用于后续协议加密 keepAliveInterval 为建议client发起心跳 KeepAlive 的间隔 * @async * @param {object} params 初始化参数 * @param {number} params.clientVer 客户端版本号，clientVer = &quot;.&quot;以前的数 * 100 + &quot;.&quot;以后的，举例：1.1版本的clientVer为1 * 100 + 1 = 101，2.21版本为2 * 100 + 21 = 221 * @param {string} params.clientID 客户端唯一标识，无生具体生成规则，客户端自己保证唯一性即可 * @param {boolean} params.recvNotify 此连接是否接收市场状态、交易需要重新解锁等等事件通知，true代表接收，FutuOpenD就会向此连接推送这些通知，反之false代表不接收不推送 * @returns {InitConnectResponse} */ async initConnect(params) { // 初始化连接 if (this.inited) throw new Error('请勿重复初始化连接'); return new Promise(async (resolve) =&gt; { this.inited = true; this.socket.onConnect(async () =&gt; { const res = await this.socket.send('InitConnect', Object.assign({ clientVer: 101, clientID: 'yisbug', recvNotify: true, }, params)); // 保持心跳 this.connID = res.connID; this.connAESKey = res.connAESKey; this.keepAliveInterval = res.keepAliveInterval; if (this.timerKeepLive) { clearInterval(this.timerKeepLive); this.timerKeepLive = null; } this.timerKeepLive = setInterval(() =&gt; this.keepAlive(), 1000 * this.keepAliveInterval); resolve(res); }); await this.socket.init(); }); } /** * GetGlobalState.proto协议返回对象 * @typedef GetGlobalStateResponse * @property {QotMarketState} marketHK Qot_Common.QotMarketState,港股主板市场状态 * @property {QotMarketState} marketUS Qot_Common.QotMarketState,美股Nasdaq市场状态 * @property {QotMarketState} marketSH Qot_Common.QotMarketState,沪市状态 * @property {QotMarketState} marketSZ Qot_Common.QotMarketState,深市状态 * @property {QotMarketState} marketHKFuture Qot_Common.QotMarketState,港股期货市场状态 * @property {boolean} qotLogined 是否登陆行情服务器 * @property {boolean} trdLogined 是否登陆交易服务器 * @property {number} serverVer 版本号 * @property {number} serverBuildNo buildNo * @property {number} time 当前格林威治时间 */ /** * GetGlobalState.proto - 1002获取全局状态 * @async * @returns {GetGlobalStateResponse} */ getGlobalState() { // 1002获取全局状态 return this.socket.send('GetGlobalState', { userID: this.userID, }); } /** * KeepAlive.proto - 1004保活心跳 * @returns {number} time 服务器回包时的格林威治时间戳，单位秒 */ async keepAlive() { // 1004保活心跳 const time = await this.socket.send('KeepAlive', { time: Math.round(Date.now() / 1000), }); return time; } /** * Qot_Sub.proto - 3001订阅或者反订阅 * 股票结构参考 Security 订阅数据类型参考 SubType 复权类型参考 RehabType 为控制定阅产生推送数据流量，股票定阅总量有额度控制，订阅规则参考 高频数据接口 高频数据接口需要订阅之后才能使用，注册推送之后才可以收到数据更新推送 * @param {object} params * @param {Security[]} params.securityList 股票 * @param {SubType[]} params.subTypeList Qot_Common.SubType,订阅数据类型 * @param {boolean} [params.isSubOrUnSub=true] ture表示订阅,false表示反订阅 * @param {boolean} [params.isRegOrUnRegPush=true] 是否注册或反注册该连接上面行情的推送,该参数不指定不做注册反注册操作 * @param {number} params.regPushRehabTypeList Qot_Common.RehabType,复权类型,注册推送并且是K线类型才生效,其他订阅类型忽略该参数,注册K线推送时该参数不指定默认前复权 * @param {boolean} [params.isFirstPush=true] 注册后如果本地已有数据是否首推一次已存在数据,该参数不指定则默认true * @async */ qotSub(params) { // 3001订阅或者反订阅 return this.socket.send('Qot_Sub', Object.assign({ securityList: [], subTypeList: [], isSubOrUnSub: true, isRegOrUnRegPush: true, regPushRehabTypeList: [], isFirstPush: true, }, params)); } /** * Qot_RegQotPush.proto - 3002注册行情推送 * 股票结构参考 Security 订阅数据类型参考 SubType 复权类型参考 RehabType 行情需要订阅成功才能注册推送 * @param {object} params Object * @param {Security[]} params.securityList 股票 * @param {SubType[]} params.subTypeList Qot_Common.SubType,订阅数据类型 * @param {SubType[]} params.rehabTypeList Qot_Common.RehabType,复权类型,注册K线类型才生效,其他订阅类型忽略该参数,注册K线时该参数不指定默认前复权 * @param {boolean} [params.isRegOrUnReg=true] 注册或取消 * @param {boolean} [params.isFirstPush=true] 注册后如果本地已有数据是否首推一次已存在数据,该参数不指定则默认true * @async */ qotRegQotPush(params) { // 3002注册行情推送 return this.socket.send('Qot_RegQotPush', Object.assign({ securityList: [], subTypeList: [], rehabTypeList: [], isRegOrUnReg: true, isFirstPush: true, }, params)); } /** * Qot_GetSubInfo.proto协议返回对象 * @typedef QotGetSubInfoResponse * @property {ConnSubInfo[]} connSubInfoList 订阅信息 * @property {number} totalUsedQuota FutuOpenD已使用的订阅额度 * @property {number} remainQuota FutuOpenD剩余订阅额度 */ /** * Qot_GetSubInfo.proto - 3003获取订阅信息 * @async * @param {boolean} [isReqAllConn=false] 是否返回所有连接的订阅状态，默认false * @returns {QotGetSubInfoResponse} */ qotGetSubInfo(isReqAllConn = false) { // 3003获取订阅信息 return this.socket.send('Qot_RegQotPush', { isReqAllConn, }); } /** * Qot_GetBasicQot.proto - 3004获取股票基本行情 * 股票结构参考 Security 基本报价结构参考 BasicQot * @param {Security[]} securityList 股票列表 * @returns {BasicQot[]} basicQotList 股票基本报价 * @async */ async qotGetBasicQot(securityList) { // 3004获取股票基本行情 return (await this.socket.send('Qot_GetBasicQot', { securityList, })).basicQotList; } /** * 注册股票基本报价通知，需要先调用订阅接口 * Qot_UpdateBasicQot.proto - 3005推送股票基本报价 * @async * @param {function} callback 回调 * @returns {BasicQot[]} basicQotList */ subQotUpdateBasicQot(callback) { // 注册股票基本报价通知 return this.socket.subNotify(3005, data =&gt; callback(data.basicQotList)); } /** * Qot_GetKL.proto - 3006获取K线 * 复权类型参考 RehabType K线类型参考 KLType 股票结构参考 Security K线结构参考 KLine 请求K线目前最多最近1000根 * @param {object} params * @param {RehabType} params.rehabType Qot_Common.RehabType,复权类型 * @param {KLType} params.klType Qot_Common.KLType,K线类型 * @param {Security} params.security 股票 * @param {number} params.reqNum 请求K线根数 * @async * @returns {KLine[]} k线点 */ async qotGetKL(params) { // 3006获取K线 return (await this.socket.send('Qot_GetKL', Object.assign({ rehabType: 1, // Qot_Common.RehabType,复权类型 klType: 1, // Qot_Common.KLType,K线类型 security: {}, // 股票 reqNum: 60, // 请求K线根数 }, params))).klList; } /** * Qot_UpdateKL.proto协议返回对象 * @typedef QotUpdateKLResponse * @property {RehabType} rehabType Qot_Common.RehabType,复权类型 * @property {KLType} klType Qot_Common.KLType,K线类型 * @property {Security} security 股票 * @property {KLine[]} klList 推送的k线点 */ /** * 注册K线推送，需要先调用订阅接口 * Qot_UpdateKL.proto - 3007推送K线 * @async * @returns {KLine[]} 推送的k线点 */ subQotUpdateKL(callback) { // 注册K线推送 return this.socket.subNotify(3007, data =&gt; callback(data.klList)); } /** * Qot_GetRT.proto协议返回对象 * @typedef QotGetRTResponse * @property {Security} security 股票 * @property {TimeShare[]} rtList 分时点 */ /** * Qot_GetRT.proto - 3008获取分时 * @async * @param {Security} security 股票 * @returns {QotGetRTResponse} */ qotGetRT(security) { // 获取分时 return this.socket.send('Qot_GetRT', { security, }); } /** * 注册分时推送，需要先调用订阅接口 * Qot_UpdateRT.proto - 3009推送分时 * @async * @returns {QotGetRTResponse} */ subQotUpdateRT(callback) { // 注册分时推送 return this.socket.subNotify(3009, callback); } /** * Qot_GetTicker.proto协议返回对象 * @typedef QotGetTickerResponse * @property {Security} security 股票 * @property {Ticker[]} tickerList 逐笔 */ /** * Qot_GetTicker.proto - 3010获取逐笔 * 股票结构参考 Security 逐笔结构参考 Ticker 请求逐笔目前最多最近1000个 * @param {Security} security 股票 * @param {number} maxRetNum 最多返回的逐笔个数,实际返回数量不一定会返回这么多,最多返回1000个，默认100 * @returns {QotGetTickerResponse} * @async */ qotGetTicker(security, maxRetNum = 100) { // 3010获取逐笔 return this.socket.send('Qot_GetTicker', { security, maxRetNum, }); } /** * 注册逐笔推送，需要先调用订阅接口 * Qot_UpdateTicker.proto - 3011推送逐笔 * @async * @param {function} callback 回调 * @returns {QotGetTickerResponse} */ subQotUpdateTicker(callback) { // 注册逐笔推送 return this.socket.subNotify(3011, callback); } /** * Qot_GetOrderBook.proto协议返回对象 * @typedef QotGetOrderBookResponse * @property {Security} security 股票 * @property {OrderBook[]} orderBookAskList 卖盘 * @property {OrderBook[]} orderBookBidList 买盘 */ /** * Qot_GetOrderBook.proto - 3012获取买卖盘，需要先调用订阅接口 * @async * @param {Security} security 股票 * @param {number} num 请求的摆盘个数（1-10），默认10 * @returns {QotGetOrderBookResponse} */ async qotGetOrderBook(security, num = 10) { // 3012获取买卖盘 const result = await this.socket.send('Qot_GetOrderBook', { security, num, }); result.orderBookAskList = result.orderBookAskList || []; result.orderBookBidList = result.orderBookBidList || []; result.sellList = result.orderBookAskList; result.buyList = result.orderBookBidList; result.sellList.forEach((item) =&gt; { item.volume = Number(item.volume); }); result.buyList.forEach((item) =&gt; { item.volume = Number(item.volume); }); return result; } /** * 注册买卖盘推送，需要先调用订阅接口 * Qot_UpdateOrderBook.proto - 3013推送买卖盘 * @async * @param {function} callback 回调 * @const result = await s {QotGetOrderBookResponse} */ subQotUpdateOrderBook(callback) { // 注册买卖盘推送 return this.socket.subNotify(3013, (data) =&gt; { data.sellList = data.orderBookAskList || []; data.buyList = data.orderBookBidList || []; data.sellList.forEach((item) =&gt; { item.volume = Number(item.volume); }); data.buyList.forEach((item) =&gt; { item.volume = Number(item.volume); }); callback(data); }); } /** * Qot_GetBroker.proto协议返回对象 * @typedef QotGetBrokerResponse * @property {Security} security 股票 * @property {Broker[]} brokerAskList 经纪Ask(卖)盘 * @property {Broker[]} brokerBidList 经纪Bid(买)盘 */ /** * Qot_GetBroker.proto - 3014获取经纪队列 * @async * @param {Security} security Object 股票 * @returns {QotGetBrokerResponse} */ async qotGetBroker(security) { // 3014获取经纪队列 const result = await this.socket.send('Qot_GetBroker', { security, }); result.brokerAskList = result.brokerAskList || []; result.brokerBidList = result.brokerBidList || []; result.sellList = result.brokerAskList; result.buyList = result.brokerBidList; return result; } /** * 注册经纪队列推送，需要先调用订阅接口 * Qot_UpdateBroker.proto - 3015推送经纪队列 * @async * @param {function} callback 回调 * @returns {QotGetBrokerResponse} */ subQotUpdateBroker(callback) { // 注册经纪队列推送 return this.socket.subNotify(3015, (result) =&gt; { result.brokerAskList = result.brokerAskList || []; result.brokerBidList = result.brokerBidList || []; result.sellList = result.brokerAskList; result.buyList = result.brokerBidList; callback(result); }); } /** * Qot_GetHistoryKL.proto协议返回对象 * @typedef QotGetHistoryKLResponse * @property {Security} security 股票 * @property {KLine[]} klList K线数据 * @property {string} nextKLTime 如请求不指定maxAckKLNum值，则不会返回该字段，该字段表示超过指定限制的下一K线时间字符串 */ /** * Qot_GetHistoryKL.proto - 3100获取单只股票一段历史K线 * @async * @param {object} params * @param {RehabType} params.rehabType Qot_Common.RehabType,复权类型 * @param {KLType} params.klType Qot_Common.KLType,K线类型 * @param {Security} params.security 股票市场以及股票代码 * @param {string} params.beginTime 开始时间字符串 * @param {string} params.endTime 结束时间字符串 * @param {number} [params.maxAckKLNum] 最多返回多少根K线，如果未指定表示不限制 * @param {number} [params.needKLFieldsFlag] 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 * @returns {QotGetHistoryKLResponse} */ qotGetHistoryKL(params) { // 3100获取单只股票一段历史K线 return this.socket.send('Qot_GetHistoryKL', Object.assign({ rehabType: 1, // Qot_Common.RehabType,复权类型 klType: 1, // Qot_Common.KLType,K线类型 security: {}, // 股票市场以及股票代码 beginTime: '', // 开始时间字符串 endTime: '', // 结束时间字符串 maxAckKLNum: 60, // 最多返回多少根K线，如果未指定表示不限制 needKLFieldsFlag: 512, // 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 }, params)); } /** * 当请求时间点数据为空时，如何返回数据 * NoDataMode_Null = 0; //直接返回空数据 NoDataMode_Forward = 1; //往前取值，返回前一个时间点数据 NoDataMode_Backward = 2; //向后取值，返回后一个时间点数据 * @typedef {number} NoDataMode */ /** * 这个时间点返回数据的状态以及来源 * DataStatus_Null = 0; //空数据 DataStatus_Current = 1; //当前时间点数据 DataStatus_Previous = 2; //前一个时间点数据 DataStatus_Back = 3; //后一个时间点数据 * @typedef {number} DataStatus */ /** * K线数据 * * @typedef HistoryPointsKL * @property {DataStatus} status DataStatus,数据状态 * @property {string} reqTime 请求的时间 * @property {KLine} kl K线数据 */ /** * 多只股票的多点历史K线点 * * @typedef SecurityHistoryKLPoints * @property {Security} security 股票 * @property {HistoryPointsKL} klList K线数据 */ /** * Qot_GetHistoryKLPoints.proto协议返回对象 * @typedef QotGetHistoryKLPointsResponse * @property {SecurityHistoryKLPoints[]} klPointList 多只股票的多点历史K线点 * @property {boolean} hasNext 如请求不指定maxReqSecurityNum值，则不会返回该字段，该字段表示请求是否还有超过指定限制的数据 */ /** * Qot_GetHistoryKLPoints.proto - 3101获取多只股票多点历史K线 * 复权类型参考 RehabType K线类型参考 KLType 股票结构参考 Security K线结构参考 KLine K线字段类型参考 KLFields 目前限制最多5个时间点，股票个数不做限制，但不建议传入过多股票，查询耗时过多会导致协议返回超时。 * @async * @param {object} params * @param {RehabType} params.rehabType Qot_Common.RehabType,复权类型 * @param {KLType} params.klType Qot_Common.KLType,K线类型 * @param {NoDataMode} params.noDataMode NoDataMode,当请求时间点数据为空时，如何返回数据 * @param {Security[]} params.securityList 股票市场以及股票代码 * @param {string[]} params.timeList 时间字符串 * @param {number} [params.maxReqSecurityNum] 最多返回多少只股票的数据，如果未指定表示不限制 * @param {KLFields} [params.needKLFieldsFlag] 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 * @returns {QotGetHistoryKLPointsResponse} */ qotGetHistoryKLPoints(params) { // 3101获取多只股票多点历史K线 return this.socket.send('Qot_GetHistoryKLPoints', Object.assign({ rehabType: 1, // Qot_Common.RehabType,复权类型 klType: 1, // Qot_Common.KLType,K线类型 noDataMode: 0, // NoDataMode,当请求时间点数据为空时，如何返回数据。0 securityList: [], // 股票市场以及股票代码 timeList: [], // 时间字符串 maxReqSecurityNum: 60, // 最多返回多少只股票的数据，如果未指定表示不限制 needKLFieldsFlag: 512, // 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 }, params)); } /** * 公司行动组合,指定某些字段值是否有效 * CompanyAct_None = 0; //无 CompanyAct_Split = 1; //拆股 CompanyAct_Join = 2; //合股 CompanyAct_Bonus = 4; //送股 CompanyAct_Transfer = 8; //转赠股 CompanyAct_Allot = 16; //配股 CompanyAct_Add = 32; //增发股 CompanyAct_Dividend = 64; //现金分红 CompanyAct_SPDividend = 128; //特别股息 * @typedef {number} CompanyAct */ /** * 复权信息 * * @typedef Rehab * @property {string} time 时间字符串 * @property {CompanyAct} companyActFlag 公司行动组合,指定某些字段值是否有效 * @property {number} fwdFactorA 前复权因子A * @property {number} fwdFactorB 前复权因子B * @property {number} bwdFactorA 后复权因子A * @property {number} bwdFactorB 后复权因子B * @property {number} [splitBase] 拆股(eg.1拆5，Base为1，Ert为5) * @property {number} [splitErt] * @property {number} [joinBase] 合股(eg.50合1，Base为50，Ert为1) * @property {number} [joinErt] * @property {number} [bonusBase] 送股(eg.10送3, Base为10,Ert为3) * @property {number} [bonusErt] * @property {number} [transferBase] 转赠股(eg.10转3, Base为10,Ert为3) * @property {number} [transferErt] * @property {number} [allotBase] 配股(eg.10送2, 配股价为6.3元, Base为10, Ert为2, Price为6.3) * @property {number} [allotErt] * @property {number} [allotPrice] * @property {number} [addBase] 增发股(eg.10送2, 增发股价为6.3元, Base为10, Ert为2, Price为6.3) * @property {number} [addErt] * @property {number} [addPrice] * @property {number} [dividend] 现金分红(eg.每10股派现0.5元,则该字段值为0.05) * @property {number} [spDividend] 特别股息(eg.每10股派特别股息0.5元,则该字段值为0.05) */ /** * 股票复权信息 * * @typedef SecurityRehab * @property {Security} security 股票 * @property {Rehab[]} rehabList 复权信息 */ /** * Qot_GetRehab.proto - 3102获取复权信息 * @async * @param {Security[]} securityList 股票列表 * @returns {SecurityRehab[]} securityRehabList 多支股票的复权信息 */ qotGetRehab(securityList) { // 3102获取复权信息 return this.socket.send('Qot_GetRehab', { securityList, }); } /** * TradeDate * * @typedef TradeDate * @property {string} time 时间字符串 */ /** * Qot_GetTradeDate.proto - 3200获取市场交易日 * @async * @param {QotMarket} market Qot_Common.QotMarket,股票市场 * @param {string} beginTime 开始时间字符串 * @param {string} endTime 结束时间字符串 * @return {TradeDate[]} tradeDateList 交易日 */ qotGetTradeDate(market = 1, beginTime = '2018-01-01 00:00:00', endTime = '2018-02-01 00:00:00') { // 3200获取市场交易日 return this.socket.send('Qot_GetTradeDate', { market, beginTime, endTime, }); } /** * Qot_GetStaticInfo.proto - 3202获取股票静态信息 * @async * @param {QotMarket} market Qot_Common.QotMarket,股票市场 * @param {SecurityType} secType Qot_Common.SecurityType,股票类型 * @returns {SecurityStaticInfo[]} 静态信息数组 */ async qotGetStaticInfo(market = 1, secType) { // 3202获取股票静态信息 return (await this.socket.send('Qot_GetStaticInfo', { market, secType, })).staticInfoList; } /** * 正股类型额外数据 * @typedef EquitySnapshotExData * @property {number} issuedShares 发行股本,即总股本 * @property {number} issuedMarketVal 总市值 =总股本*当前价格 * @property {number} netAsset 资产净值 * @property {number} netProfit 盈利（亏损） * @property {number} earningsPershare 每股盈利 * @property {number} outstandingShares 流通股本 * @property {number} outstandingMarketVal 流通市值 =流通股本*当前价格 * @property {number} netAssetPershare 每股净资产 * @property {number} eyRate 收益率 * @property {number} peRate 市盈率 * @property {number} pbRate 市净率 */ /** * 涡轮类型额外数据 * @typedef WarrantSnapshotExData * @property {number} conversionRate 换股比率 * @property {WarrantType} warrantType Qot_Common.WarrantType,涡轮类型 * @property {number} strikePrice 行使价 * @property {string} maturityTime 到期日时间字符串 * @property {string} endTradeTime 最后交易日时间字符串 * @property {Security} owner 所属正股 * @property {number} recoveryPrice 回收价 * @property {number} streetVolumn 街货量 * @property {number} issueVolumn 发行量 * @property {number} streetRate 街货占比 * @property {number} delta 对冲值 * @property {number} impliedVolatility 引申波幅 * @property {number} premium 溢价 */ /** * 基本快照数据 * @typedef SnapshotBasicData * @property {Security} security 股票 * @property {SecurityType} type Qot_Common.SecurityType,股票类型 * @property {boolean} isSuspend 是否停牌 * @property {string} listTime 上市时间字符串 * @property {number} lotSize 每手数量 * @property {number} priceSpread 价差 * @property {string} updateTime 更新时间字符串 * @property {number} highPrice 最新价 * @property {number} openPrice 开盘价 * @property {number} lowPrice 最低价 * @property {number} lastClosePrice 昨收价 * @property {number} curPrice 最新价 * @property {number} volume 成交量 * @property {number} turnover 成交额 * @property {number} turnoverRate 换手率 */ /** * 快照 * @typedef Snapshot * @property {SnapshotBasicData} basic 快照基本数据 * @property {EquitySnapshotExData} [equityExData] 正股快照额外数据 * @property {WarrantSnapshotExData} [warrantExData] 窝轮快照额外数据 */ /** * Qot_GetSecuritySnapshot.proto - 3203获取股票快照 * 股票结构参考 Security 限频接口：30秒内最多10次 最多可传入200只股票 * @async * @param {Security[]} securityList 股票列表 * @returns {Snapshot[]} snapshotList 股票快照 */ async qotGetSecuritySnapShot(securityList) { // 3203获取股票快照 const list = [].concat(securityList); let result = []; while (list.length) { const res = (await this.socket.send('Qot_GetSecuritySnapshot', { securityList: list.splice(-200), })).snapshotList; result = result.concat(res); await sleep(1000 * 3); } return result; } /** * PlateInfo * @typedef PlateInfo * @property {Security} plate 板块 * @property {string} name 板块名字 */ /** * Qot_GetPlateSet.proto - 3204获取板块集合下的板块 * @async * @param {QotMarket} market Qot_Common.QotMarket,股票市场 * @param {PlateSetType} plateSetType Qot_Common.PlateSetType,板块集合的类型 * @returns {PlateInfo[]} plateInfoList 板块集合下的板块信息 */ qotGetPlateSet(market = 1, plateSetType) { // 3204获取板块集合下的板块 return this.socket.send('Qot_GetPlateSet', { market, plateSetType, }); } /** * Qot_GetPlateSecurity.proto - 3205获取板块下的股票 * @async * @param {Security} plate 板块 * @returns {SecurityStaticInfo[]} staticInfoList 板块下的股票静态信息 */ qotGetPlateSecurity(plate) { // 3205获取板块下的股票 return this.socket.send('Qot_GetPlateSecurity', { plate, }); } /** * Trd_GetAccList.proto - 2001获取交易账户列表 * @async * @param {number} userID 需要跟FutuOpenD登陆的牛牛用户ID一致，否则会返回失败 * @param {QotMarket} [market=1] Qot_Common.QotMarket,股票市场 * @returns {TrdAcc[]} 交易业务账户列表 */ async trdGetAccList(userID = this.userID, market = 1) { // 2001获取交易账户列表 const { accList, } = (await this.socket.send('Trd_GetAccList', { userID, })); return accList.filter(acc =&gt; acc.trdMarketAuthList.includes(market)); // return this.socket.send('Trd_GetAccList', { // userID, // }); } /** * Trd_UnlockTrade.proto - 2005解锁或锁定交易 * 除2001协议外，所有交易协议请求都需要FutuOpenD先解锁交易 密码MD5方式获取请参考 FutuOpenD配置 内的login_pwd_md5字段 解锁或锁定交易针对与FutuOpenD，只要有一个连接解锁，其他连接都可以调用交易接口 强烈建议有实盘交易的用户使用加密通道，参考 加密通信流程 限频接口：30秒内最多10次 * @param {boolean} [unlock=true] true解锁交易，false锁定交易，默认true * @param {string} [pwdMD5] 交易密码的MD5转16进制(全小写)，解锁交易必须要填密码，锁定交易不需要验证密码，可不填 * @async */ trdUnlockTrade(unlock = true, pwdMD5 = '') { // 2005解锁或锁定交易 if (pwdMD5) this.pwdMD5 = pwdMD5; return this.socket.send('Trd_UnlockTrade', { unlock, pwdMD5: pwdMD5 || this.pwdMD5, }); } /** * Trd_SubAccPush.proto - 2008订阅接收交易账户的推送数据 * @async * @param {number[]} accIDList 要接收推送数据的业务账号列表，全量非增量，即使用者请每次传需要接收推送数据的所有业务账号 */ async trdSubAccPush(accIDList) { // 2008订阅接收交易账户的推送数据 return this.socket.send('Trd_SubAccPush', { accIDList, }); } /** * 设置交易模块的公共header，调用交易相关接口前必须先调用此接口。 * @param {TrdEnv} trdEnv 交易环境, 参见TrdEnv的枚举定义。0为仿真，1为真实，默认为1。 * @param {number} accID 业务账号, 业务账号与交易环境、市场权限需要匹配，否则会返回错误，默认为当前userID * @param {TrdMarket} [trdMarket=1] 交易市场, 参见TrdMarket的枚举定义，默认为1，即香港市场。 */ setCommonTradeHeader(trdEnv, accID, trdMarket = 1) { // 设置交易模块的公共header，调用交易相关接口前必须先调用此接口。 this.market = trdMarket; this.trdHeader = { trdEnv, accID, trdMarket, }; } /** * Trd_GetFunds.proto - 2101获取账户资金，需要先设置交易模块公共header * @returns {Funds} */ async trdGetFunds() { // 2101获取账户资金 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_GetFunds', { header: this.trdHeader, })).funds; } /** * Trd_GetPositionList.proto - 2102获取持仓列表 * @async * @param {TrdFilterConditions} filterConditions 过滤条件 * @param {number} filterPLRatioMin 过滤盈亏比例下限，高于此比例的会返回，如0.1，返回盈亏比例大于10%的持仓 * @param {number} filterPLRatioMax 过滤盈亏比例上限，低于此比例的会返回，如0.2，返回盈亏比例小于20%的持仓 * @returns {Position[]} 持仓列表数组 */ async trdGetPositionList(filterConditions, filterPLRatioMin, filterPLRatioMax) { // 2102获取持仓列表 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_GetPositionList', { header: this.trdHeader, // 交易公共参数头 filterConditions, // 过滤条件 filterPLRatioMin, // 过滤盈亏比例下限，高于此比例的会返回，如0.1，返回盈亏比例大于10%的持仓 filterPLRatioMax, // 过滤盈亏比例上限，低于此比例的会返回，如0.2，返回盈亏比例小于20%的持仓 })).positionList; } /** * Trd_GetOrderList.proto - 2201获取订单列表 * @async * @param {TrdFilterConditions} filterConditions 过滤条件 * @param {OrderStatus[]} filterStatusList 需要过滤的订单状态列表 * @returns {Order[]} 订单列表 */ async trdGetOrderList(filterConditions, filterStatusList) { // 2201获取订单列表 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_GetOrderList', { header: this.trdHeader, // 交易公共参数头 filterConditions, filterStatusList, })).orderList; } /** * Trd_PlaceOrder.proto - 2202下单 * 请求包标识结构参考 PacketID 交易公共参数头结构参考 TrdHeader 交易方向枚举参考 TrdSide 订单类型枚举参考 OrderType 限频接口：30秒内最多30次 * @async * @param {object} params * @param {PacketID} [params.packetID] 交易写操作防重放攻击，默认不用填写 * @param {TrdHeader} [params.header] 交易公共参数头，默认不用填写 * @param {TrdSide} params.trdSide 交易方向, 参见Trd_Common.TrdSide的枚举定义 * @param {OrderType} params.orderType 订单类型, 参见Trd_Common.OrderType的枚举定义 * @param {string} params.code 代码 * @param {number} params.qty 数量，2位精度，期权单位是&quot;张&quot; * @param {number} [params.price] 价格，3位精度(A股2位) * 以下为调整价格使用，目前仅对港、A股有效，因为港股有价位，A股2位精度，美股不需要 * @param {boolean} [params.adjustPrice] 是否调整价格，如果价格不合法，是否调整到合法价位，true调整，false不调整 * @param {number} [params.adjustSideAndLimit] 调整方向和调整幅度百分比限制，正数代表向上调整，负数代表向下调整，具体值代表调整幅度限制，如：0.015代表向上调整且幅度不超过1.5%；-0.01代表向下调整且幅度不超过1% * @returns {number} orderID 订单号 */ async trdPlaceOrder(params) { // 2202下单 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_PlaceOrder', Object.assign({ packetID: { connID: this.connID, serialNo: this.socket.requestId, }, // 交易写操作防重放攻击 header: this.trdHeader, // 交易公共参数头 trdSide: 0, // 交易方向，1买入，2卖出 orderType: 1, // 订单类型, 参见Trd_Common.OrderType的枚举定义 code: '', // 代码 qty: 0, // 数量，2位精度，期权单位是&quot;张&quot; price: 0, // 价格，3位精度(A股2位) // 以下为调整价格使用，目前仅对港、A股有效，因为港股有价位，A股2位精度，美股不需要 adjustPrice: false, // 是否调整价格，如果价格不合法，是否调整到合法价位，true调整，false不调整 adjustSideAndLimit: 0, // 调整方向和调整幅度百分比限制，正数代表向上调整，负数代表向下调整，具体值代表调整幅度限制，如：0.015代表向上调整且幅度不超过1.5%；-0.01代表向下调整且幅度不超过1% }, params))).orderID; } /** * 2202市价下单，直到成功为止，返回买入/卖出的总价格 * * @async * @param {object} param * @param {TrdSide} params.trdSide 交易方向, 参见Trd_Common.TrdSide的枚举定义 * @param {string} params.code 代码 * @param {number} params.qty 数量，2位精度，期权单位是&quot;张&quot; * @returns {number} 卖出/买入总价 */ async trdPlaceOrderMarket(param) { // 市价买入卖出 const { trdSide, code, qty } = param; // trdSide 1买入2卖出 let remainQty = qty; let value = 0; while (remainQty &gt; 0) { let orderID = null; let order = null; const orderBooks = await this.qotGetOrderBook({ market: 1, code });// 获取盘口 const price = trdSide === 1 ? orderBooks.sellList[0].price : orderBooks.buyList[0].price; if (orderID &amp;&amp; order.orderStatus === 10) { await this.trdModifyOrder({// 修改订单并设置订单为有效 modifyOrderOp: 4, orderID, price, qty: remainQty, }); } else if (!orderID) { orderID = await this.trdPlaceOrder({ trdSide, code, qty: remainQty, price, }); // 下单 } // eslint-disable-next-line while (true) { // 确认了不传入过滤条件会返回所有订单 const list = await this.trdGetOrderList({}, []); // eslint-disable-next-line order = list.filter(item =&gt; item.orderID === orderID); if (order) { if (order.orderStatus &gt; 11) { order = null; orderID = null; break; } else if (order.orderStatus &lt; 10) { await sleep(50); } else if (order.fillQty &gt; 0) { remainQty -= order.fillQty; value += order.price * order.fillQty; if (remainQty &gt; 0 &amp;&amp; order.orderStatus === 10) { // 部分成交，先设置为失效 await this.trdModifyOrder({ modifyOrderOp: 3, orderID }); // 失效 } } } else { await sleep(60); } } } return value; } /** * Trd_ModifyOrder.proto - 2205修改订单(改价、改量、改状态等) * 请求包标识结构参考 PacketID 交易公共参数头结构参考 TrdHeader 修改操作枚举参考 ModifyOrderOp 限频接口：30秒内最多30次 * @async * @param {object} params * @param {PacketID} [params.packetID] 交易写操作防重放攻击，默认不用填写 * @param {TrdHeader} [params.header] 交易公共参数头，默认不用填写 * @param {number} params.orderID 订单号，forAll为true时，传0 * @param {ModifyOrderOp} params.modifyOrderOp 修改操作类型，参见Trd_Common.ModifyOrderOp的枚举定义 * @param {boolean} [params.forAll] 是否对此业务账户的全部订单操作，true是，false否(对单个订单)，无此字段代表false，仅对单个订单 * 下面的字段仅在modifyOrderOp为ModifyOrderOp_Normal有效 * @param {number} [params.qty] 数量，2位精度，期权单位是&quot;张&quot; * @param {number} [params.price] 价格，3位精度(A股2位) * 以下为调整价格使用，目前仅对港、A股有效，因为港股有价位，A股2位精度，美股不需要 * @param {boolean} [params.adjustPrice] 是否调整价格，如果价格不合法，是否调整到合法价位，true调整，false不调整 * @param {number} [params.adjustSideAndLimit] 调整方向和调整幅度百分比限制，正数代表向上调整，负数代表向下调整，具体值代表调整幅度限制，如：0.015代表向上调整且幅度不超过1.5%；-0.01代表向下调整且幅度不超过1% * @returns {number} orderID 订单号 */ async trdModifyOrder(params) { // 2205修改订单(改价、改量、改状态等) if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_ModifyOrder', Object.assign({ packetID: { connID: this.connID, serialNo: this.socket.requestId, }, // 交易写操作防重放攻击 header: this.trdHeader, // 交易公共参数头 orderID: 0, // 订单号，forAll为true时，传0 modifyOrderOp: 1, // //修改操作类型，参见Trd_Common.ModifyOrderOp的枚举定义 forAll: false, // /是否对此业务账户的全部订单操作，true是，false否(对单个订单)，无此字段代表false，仅对单个订单 qty: 0, // 数量，2位精度，期权单位是&quot;张&quot; price: 0, // 价格，3位精度(A股2位) // 以下为调整价格使用，目前仅对港、A股有效，因为港股有价位，A股2位精度，美股不需要 adjustPrice: false, // 是否调整价格，如果价格不合法，是否调整到合法价位，true调整，false不调整 adjustSideAndLimit: 0, // 调整方向和调整幅度百分比限制，正数代表向上调整，负数代表向下调整，具体值代表调整幅度限制，如：0.015代表向上调整且幅度不超过1.5%；-0.01代表向下调整且幅度不超过1% }, params))).orderID; } /** * 注册订单更新通知 * Trd_UpdateOrder.proto - 2208推送订单更新 * @async * @param {function} callback 回调 * @returns {Order} 订单结构 */ async subTrdUpdateOrder(callback) { // 注册订单更新通知 return this.socket.subNotify(2208, data =&gt; callback(data.order)); } /** * 取消注册订单更新通知 * Trd_UpdateOrder.proto - 2208推送订单更新 * @async */ async unsubTrdUpdateOrder() { // 取消注册订单更新通知 return this.socket.unsubNotify(2208); } /** * Trd_GetOrderFillList.proto - 2211获取成交列表 * @async * @param {TrdFilterConditions} filterConditions 过滤条件 * @returns {OrderFill[]} 成交列表 */ async trdGetOrderFillList(filterConditions) { // 2211获取成交列表 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_GetOrderFillList', { header: this.trdHeader, // 交易公共参数头 filterConditions, })).orderFillList; } /** * 注册新成交通知 * Trd_UpdateOrderFill.proto - 2218推送新成交 * @param {function} callback 回调 * @returns {OrderFill} 成交结构 */ async subTrdUpdateOrderFill(callback) { // 注册新成交通知 return this.socket.subNotify(2218, data =&gt; callback(data.orderFill)); } /** * Trd_GetHistoryOrderList.proto - 2221获取历史订单列表 * 交易公共参数头结构参考 TrdHeader 订单结构参考 Order 过滤条件结构参考 TrdFilterConditions 订单状态枚举参考 OrderStatus 限频接口：30秒内最多10次 * @async * @param {TrdFilterConditions} filterConditions 过滤条件 * @param {OrderStatus} filterStatusList OrderStatus, 需要过滤的订单状态列表 * @returns {Order[]} 历史订单列表 */ async trdGetHistoryOrderList(filterConditions, filterStatusList) { // 2221获取历史订单列表 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_GetHistoryOrderList', { header: this.trdHeader, // 交易公共参数头 filterConditions, filterStatusList, })).orderList; } /** * Trd_GetHistoryOrderFillList.proto - 2222获取历史成交列表 * 交易公共参数头结构参考 TrdHeader 成交结构参考 OrderFill 过滤条件结构参考 TrdFilterConditions 限频接口：30秒内最多10次 * @async * @param {TrdFilterConditions} filterConditions 过滤条件 * @returns {OrderFill[]} 历史成交列表 */ async trdGetHistoryOrderFillList(filterConditions) { // 2222获取历史成交列表 if (!this.trdHeader) throw new Error('请先调用setCommonTradeHeader接口设置交易公共header'); return (await this.socket.send('Trd_GetHistoryOrderFillList', { header: this.trdHeader, // 交易公共参数头 filterConditions, })).orderFillList; } } export default FutuQuant; × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "},"socket.mjs.html":{"id":"socket.mjs.html","title":"Source: socket.mjs","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result Source: socket.mjs /** - **所有行情相关协议获取数据都需要先通过（1005）协议订阅成功后才能查询** - **订阅的上限为500个订阅单位。一只股票的一个K线类型占2个订阅单位、分时占2个订阅单位、 - 报价占1个订阅单位、摆盘占5个订阅单位（牛熊为1）、逐笔占5个订阅单位（牛熊为1）、经纪队列占5个订阅单位（牛熊为1）。** - **反订阅（1006）的时间限制为１分钟，即订阅某支股票某个订阅位１分钟之后才能反订阅** - **30秒内不能超过20次交易请求。** - **建议所有行情拉取接口在同一条长连接上。推送数据在第二条长连接上。交易接口在第三条长连接上。** */ import net from 'net'; import protobufjs from 'protobufjs'; import hexSha1 from 'hex-sha1'; import ProtoId from './protoid'; import Pb from './pb.json'; const ProtoName = {}; Object.keys(ProtoId).forEach((key) =&gt; { ProtoName[ProtoId[key]] = key; }); let id = 1; /** * Socket模块 */ class Socket { /** * Creates an instance of Socket. * @param {string} ip OpenD服务Ip * @param {number} port OpenD服务端口 * @param {object} logger 日志对象 */ constructor(ip, port, logger) { /** * OpenD服务IP * @type {string} */ this.ip = ip; /** * OpenD服务端口 * @type {number} */ this.port = port; /** * 日志对象 * @type {object} */ this.logger = logger; id += 1; /** * socket id，自增，用于区分多个socket。 * @type {number} */ this.id = id; /** * socket名称，用于区分多个socket。 * @type {string} */ this.name = `Socket(${this.id})`; /** * socket是否已经连接 * @type {boolean} */ this.isConnect = false; /** * 请求序列号，自增 * @type {number} */ this.requestId = 1000; // 请求序列号，自增 this.root = protobufjs.Root.fromJSON(Pb); this.cacheResponseCallback = {}; // 缓存的回调函数 this.cacheNotifyCallback = {}; // 缓存的通知回调函数 this.header = null; // 缓存接收的数据包头 this.recvBuffer = Buffer.allocUnsafe(0); // 缓存接收的数据 this.socket = new net.Socket(); this.socket.setKeepAlive(true); this.socket.on('error', (data) =&gt; { this.logger.error(`${this.name} on error: ${data}`); this.socket.destroy(); this.isConnect = false; }); this.socket.on('timeout', (e) =&gt; { this.logger.error(`${this.name} on timeout.`, e); this.socket.destroy(); this.isConnect = false; }); // 为客户端添加“close”事件处理函数 this.socket.on('close', () =&gt; { const errMsg = `${this.name} on closed and retry connect on 5 seconds.`; this.logger.error(errMsg); this.isConnect = false; // 5s后重连 if (this.timerRecontent) return; this.timerRecontent = setTimeout(() =&gt; { this.init(); }, 5000); }); // 接收数据 this.socket.on('data', (data) =&gt; { this.recvBuffer = Buffer.concat([this.recvBuffer, data]); this.parseData(); }); } async init() { if (this.isConnect) return; await this.connect(); } /** * 立即建立连接 */ async connect() { return new Promise((resolve) =&gt; { if (this.timerRecontent) { clearTimeout(this.timerRecontent); this.timerRecontent = null; } this.socket.connect({ port: this.port, host: this.ip, timeout: 1000 * 30, }, async () =&gt; { this.logger.debug(`${this.name} connect success:${this.ip}:${this.port}`); this.isConnect = true; if (typeof this.connectCallback === 'function') this.connectCallback(); resolve(); }); }); } /** * 设置连接成功的回调函数 * * @param {function} cb * @memberof Socket */ onConnect(cb) { this.connectCallback = cb; } /** * 注册协议的通知 * * @param {number} protoId 协议id * @param {function} callback 回调函数 */ subNotify(protoId, callback) { this.cacheNotifyCallback[protoId] = callback; } /** * 删除一个通知 * @param {number} protoId 协议id */ unsubNotify(protoId) { if (this.cacheNotifyCallback[protoId]) { delete this.cacheNotifyCallback[protoId]; } } /** * 发送数据 * * @async * @param {string} protoName 协议名称 * @param {object} message 要发送的数据 */ send(protoName, message) { if (!this.isConnect) return this.logger.warn(`${this.name} 尚未连接，无法发送请求。`); const protoId = ProtoId[protoName]; if (!protoId) return this.logger.warn(`找不到对应的协议Id:${protoName}`); // 请求序列号，自增 if (this.requestId &gt; 1000000) this.requestId = 1000; const { requestId } = this; this.requestId += 1; const request = this.root[protoName].Request; const response = this.root[protoName].Response; // 处理请求数据 const reqBuffer = request.encode(request.create({ c2s: message, })).finish(); const sha1 = hexSha1(reqBuffer); const sha1Buffer = new Uint8Array(20).map((item, index) =&gt; Number(`0x${sha1.substr(index * 2, 2)}`)); this.logger.debug(`request:${protoName}(${protoId}),reqId:${requestId}`); // 处理包头 const buffer = Buffer.concat([ Buffer.from('FT'), // 包头起始标志，固定为“FT” Buffer.from(new Uint32Array([protoId]).buffer), // 协议ID Buffer.from(new Uint8Array([0]).buffer), // 协议格式类型，0为Protobuf格式，1为Json格式 Buffer.from(new Uint8Array([0]).buffer), // 协议版本，用于迭代兼容, 目前填0 Buffer.from(new Uint32Array([requestId]).buffer), // 包序列号，用于对应请求包和回包, 要求递增 Buffer.from(new Uint32Array([reqBuffer.length]).buffer), // 包体长度 Buffer.from(sha1Buffer.buffer), // 包体原始数据(解密后)的SHA1哈希值 Buffer.from(new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]).buffer), // 保留8字节扩展 reqBuffer, ]); // 发送请求，处理回调 this.socket.write(buffer); return new Promise((resolve, reject) =&gt; { this.cacheResponseCallback[requestId] = (responseBuffer) =&gt; { const result = response.decode(responseBuffer).toJSON(); if (result.retType === 0) return resolve(result.s2c); const errMsg = `服务器返回结果失败,request:${protoName}(${protoId}),retType:${result.retType},reqId:${requestId},errMsg:${result.retMsg}`; this.logger.error(errMsg); return reject(new Error(errMsg)); }; }); } /** * 解析包体数据 */ parseData() { const headerLen = 44; // 包头长度 let bodyBuffer = null; // 包体buffer let bodyLen = 0; // 包体长度 let reqId = null; // 请求序列号 let protoId = null; // 请求协议Id let bodySha1 = null; // 包体sha1 // 先处理包头 if (!this.header &amp;&amp; this.recvBuffer.length &gt;= headerLen) { let recvSha1 = new Array(21).join('0').split('').map((item, index) =&gt; { let str = this.recvBuffer.readUInt8(16 + index).toString(16); if (str.length === 1) str = `0${str}`; return str; }); recvSha1 = recvSha1.join(''); this.header = { // 包头起始标志，固定为“FT” szHeaderFlag: String.fromCharCode(this.recvBuffer.readUInt8(0)) + String.fromCharCode(this.recvBuffer.readUInt8(1)), nProtoID: this.recvBuffer.readUInt32LE(2), // 协议ID nProtoFmtType: this.recvBuffer.readUInt8(6), // 协议格式类型，0为Protobuf格式，1为Json格式 nProtoVer: this.recvBuffer.readUInt8(7), // 协议版本，用于迭代兼容 nSerialNo: this.recvBuffer.readUInt32LE(8), // 包序列号 nBodyLen: this.recvBuffer.readUInt32LE(12), // 包体长度 arrBodySHA1: recvSha1, // 包体原数据(解密后)的SHA1哈希值 arrReserved: this.recvBuffer.slice(36, 44), // 保留8字节扩展 }; if (this.header.szHeaderFlag !== 'FT') throw new Error('接收的包头数据格式错误'); this.logger.debug(`response:${ProtoName[this.header.nProtoID]}(${this.header.nProtoID}),reqId:${this.header.nSerialNo},bodyLen:${bodyLen}`); } // 已经接收指定包体长度的全部数据，切割包体buffer if (this.header &amp;&amp; this.recvBuffer.length &gt;= this.header.nBodyLen + headerLen) { reqId = this.header.nSerialNo; protoId = this.header.nProtoID; bodyLen = this.header.nBodyLen; bodySha1 = this.header.arrBodySHA1; this.header = null; bodyBuffer = this.recvBuffer.slice(44, bodyLen + headerLen); this.recvBuffer = this.recvBuffer.slice(bodyLen + headerLen); const sha1 = hexSha1(bodyBuffer); if (sha1 !== bodySha1) { throw new Error(`接收的包体sha1加密错误：${bodySha1},本地sha1：${sha1}`); } // 交给回调处理包体数据 if (this.cacheResponseCallback[reqId]) { this.cacheResponseCallback[reqId](bodyBuffer); delete this.cacheResponseCallback[reqId]; } // 通知模块 if (this.cacheNotifyCallback[protoId]) { try { // 加载proto协议文件 const protoName = ProtoName[protoId]; const response = this.root[protoName].Response; const result = response.decode(bodyBuffer).toJSON(); this.cacheNotifyCallback[protoId](result.s2c); } catch (e) { const errMsg = `通知回调执行错误，response:${ProtoName[protoId]}(${protoId}),reqId:${reqId},bodyLen:${bodyLen}，堆栈：${e.stack}`; this.logger.error(errMsg); throw new Error(errMsg); } } if (this.recvBuffer.length &gt; headerLen) this.parseData(); } } } export default Socket; × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "},"global.html":{"id":"global.html","title":"Global","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result Global Members &lt;async, constant&gt; result :QotGetOrderBookResponse 注册买卖盘推送，需要先调用订阅接口 Qot_UpdateOrderBook.proto - 3013推送买卖盘 Type: QotGetOrderBookResponse Source: futuquant.mjs, line 844 Type Definitions BasicQot 基础报价 Type: object Properties: Name Type Description security security 股票 isSuspended boolean 是否停牌 listTime string 上市日期字符串 priceSpread number 价差 updateTime string 更新时间字符串 highPrice number 最高价 openPrice number 开盘价 lowPrice number 最低价 curPrice number 最新价 lastClosePrice number 昨收价 volume number 成交量 turnover number 成交额 turnoverRate number 换手率 amplitude number 振幅 Source: futuquant.mjs, line 202 Broker 买卖经纪摆盘 Type: object Properties: Name Type Description id number 经纪ID name string 经纪名称 pos number 经纪档位 Source: futuquant.mjs, line 254 CompanyAct 公司行动组合,指定某些字段值是否有效 CompanyAct_None = 0; //无 CompanyAct_Split = 1; //拆股 CompanyAct_Join = 2; //合股 CompanyAct_Bonus = 4; //送股 CompanyAct_Transfer = 8; //转赠股 CompanyAct_Allot = 16; //配股 CompanyAct_Add = 32; //增发股 CompanyAct_Dividend = 64; //现金分红 CompanyAct_SPDividend = 128; //特别股息 Type: number Source: futuquant.mjs, line 999 ConnSubInfo 单条连接定阅信息 一条连接重复定阅其它连接已经订阅过的，不会额外消耗订阅额度 Properties: Name Type Description subInfoList Array.&lt;SubInfo&gt; 该连接订阅信息 usedQuota number 该连接已经使用的订阅额度 isOwnConnData boolean 用于区分是否是自己连接的数据 Source: futuquant.mjs, line 285 DataStatus 这个时间点返回数据的状态以及来源 DataStatus_Null = 0; //空数据 DataStatus_Current = 1; //当前时间点数据 DataStatus_Previous = 2; //前一个时间点数据 DataStatus_Back = 3; //后一个时间点数据 Type: number Source: futuquant.mjs, line 938 EquitySnapshotExData 正股类型额外数据 Properties: Name Type Description issuedShares number 发行股本,即总股本 issuedMarketVal number 总市值 =总股本*当前价格 netAsset number 资产净值 netProfit number 盈利（亏损） earningsPershare number 每股盈利 outstandingShares number 流通股本 outstandingMarketVal number 流通市值 =流通股本*当前价格 netAssetPershare number 每股净资产 eyRate number 收益率 peRate number 市盈率 pbRate number 市净率 Source: futuquant.mjs, line 1092 Funds 账户资金结构 Type: object Properties: Name Type Description power number 购买力，3位精度(A股2位)，下同 totalAssets number 资产净值 cash number 现金 marketVal number 证券市值 frozenCash number 冻结金额 debtCash number 欠款金额 avlWithdrawalCash number 可提金额 Source: futuquant.mjs, line 396 GetGlobalStateResponse GetGlobalState.proto协议返回对象 Properties: Name Type Description marketHK QotMarketState Qot_Common.QotMarketState,港股主板市场状态 marketUS QotMarketState Qot_Common.QotMarketState,美股Nasdaq市场状态 marketSH QotMarketState Qot_Common.QotMarketState,沪市状态 marketSZ QotMarketState Qot_Common.QotMarketState,深市状态 marketHKFuture QotMarketState Qot_Common.QotMarketState,港股期货市场状态 qotLogined boolean 是否登陆行情服务器 trdLogined boolean 是否登陆交易服务器 serverVer number 版本号 serverBuildNo number buildNo time number 当前格林威治时间 Source: futuquant.mjs, line 590 HistoryPointsKL K线数据 Properties: Name Type Description status DataStatus DataStatus,数据状态 reqTime string 请求的时间 kl KLine K线数据 Source: futuquant.mjs, line 947 InitConnectResponse 初始化连接，InitConnect.proto协议返回对象 Properties: Name Type Description serverVer number FutuOpenD的版本号 loginUserID number FutuOpenD登陆的牛牛用户ID connID number 此连接的连接ID，连接的唯一标识 connAESKey string 此连接后续AES加密通信的Key，固定为16字节长字符串 keepAliveInterval number 心跳保活间隔 Source: futuquant.mjs, line 543 KLFields 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 KLFields_None = 0; // KLFields_High = 1; //最高价 KLFields_Open = 2; //开盘价 KLFields_Low = 4; //最低价 KLFields_Close = 8; //收盘价 KLFields_LastClose = 16; //昨收价 KLFields_Volume = 32; //成交量 KLFields_Turnover = 64; //成交额 KLFields_TurnoverRate = 128; //换手率 KLFields_PE = 256; //市盈率 KLFields_ChangeRate = 512; //涨跌幅 Type: number Source: futuquant.mjs, line 133 KLine K线数据点 Type: object Properties: Name Type Argument Description time string 时间戳字符串 isBlank boolean 是否是空内容的点,若为ture则只有时间信息 highPrice number &lt;optional&gt; 最高价 openPrice number &lt;optional&gt; 开盘价 lowPrice number &lt;optional&gt; 最低价 closePrice number &lt;optional&gt; 收盘价 lastClosePrice number &lt;optional&gt; 昨收价 volume number &lt;optional&gt; 成交量 turnover number &lt;optional&gt; 成交额 turnoverRate number &lt;optional&gt; 换手率 pe number &lt;optional&gt; 市盈率 changeRate number &lt;optional&gt; 涨跌幅 Source: futuquant.mjs, line 186 KLType K线类型，枚举值兼容旧协议定义，新类型季K,年K,3分K暂时没有支持历史K线 KLType_Unknown = 0; //未知 KLType_1Min = 1; //1分K KLType_Day = 2; //日K KLType_Week = 3; //周K KLType_Month = 4; //月K KLType_Year = 5; //年K KLType_5Min = 6; //5分K KLType_15Min = 7; //15分K KLType_30Min = 8; //30分K KLType_60Min = 9; //60分K KLType_3Min = 10; //3分K KLType_Quarter = 11; //季K Type: number Source: futuquant.mjs, line 116 ModifyOrderOp 修改订单的操作类型，港股支持全部操作，美股目前仅支持ModifyOrderOp_Normal和ModifyOrderOp_Cancel ModifyOrderOp_Unknown = 0; //未知操作 ModifyOrderOp_Normal = 1; //修改订单的价格、数量等，即以前的改单 ModifyOrderOp_Cancel = 2; //撤单 ModifyOrderOp_Disable = 3; //失效 ModifyOrderOp_Enable = 4; //生效 ModifyOrderOp_Delete = 5; //删除 Type: number Source: futuquant.mjs, line 363 NoDataMode 当请求时间点数据为空时，如何返回数据 NoDataMode_Null = 0; //直接返回空数据 NoDataMode_Forward = 1; //往前取值，返回前一个时间点数据 NoDataMode_Backward = 2; //向后取值，返回后一个时间点数据 Type: number Source: futuquant.mjs, line 930 Order 订单结构 Type: object Properties: Name Type Argument Description trdSide TrdSide 交易方向, 参见TrdSide的枚举定义 orderType OrderType 订单类型, 参见OrderType的枚举定义 orderStatus OrderStatus 订单状态, 参见OrderStatus的枚举定义 orderID number 订单号 orderIDEx string 扩展订单号 code string 代码 name string 名称 qty number 订单数量，2位精度，期权单位是&quot;张&quot; price number &lt;optional&gt; 订单价格，3位精度(A股2位) createTime string 创建时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传 updateTime string 最后更新时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传 fillQty number &lt;optional&gt; 成交数量，2位精度，期权单位是&quot;张&quot; fillAvgPrice number &lt;optional&gt; 成交均价，无精度限制 lastErrMsg string &lt;optional&gt; 最后的错误描述，如果有错误，会有此描述最后一次错误的原因，无错误为空 Source: futuquant.mjs, line 428 OrderBook 买卖十档摆盘 Type: object Properties: Name Type Description price number 委托价格 volume number 委托数量 orederCount number 委托订单个数 Source: futuquant.mjs, line 272 OrderFill 成交结构 Type: object Properties: Name Type Argument Description trdSide number 交易方向, 参见TrdSide的枚举定义 fillID number 成交号 fillIDEx string 扩展成交号 orderID number &lt;optional&gt; 订单号 orderIDEx string &lt;optional&gt; 扩展订单号 code string 代码 name string 名称 qty number 订单数量，2位精度，期权单位是&quot;张&quot; price number 订单价格，3位精度(A股2位) createTime string 创建时间（成交时间），严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传 counterBrokerID number &lt;optional&gt; 对手经纪号，港股有效 counterBrokerName string &lt;optional&gt; 对手经纪名称，港股有效 Source: futuquant.mjs, line 446 OrderStatus 订单状态 OrderStatus_Unsubmitted = 0; //未提交 OrderStatus_Unknown = -1; //未知状态 OrderStatus_WaitingSubmit = 1; //等待提交 OrderStatus_Submitting = 2; //提交中 OrderStatus_SubmitFailed = 3; //提交失败，下单失败 OrderStatus_TimeOut = 4; //处理超时，结果未知 OrderStatus_Submitted = 5; //已提交，等待成交 OrderStatus_Filled_Part = 10; //部分成交 OrderStatus_Filled_All = 11; //全部已成 OrderStatus_Cancelling_Part = 12; //正在撤单_部分(部分已成交，正在撤销剩余部分) OrderStatus_Cancelling_All = 13; //正在撤单_全部 OrderStatus_Cancelled_Part = 14; //部分成交，剩余部分已撤单 OrderStatus_Cancelled_All = 15; //全部已撤单，无成交 OrderStatus_Failed = 21; //下单失败，服务拒绝 OrderStatus_Disabled = 22; //已失效 OrderStatus_Deleted = 23; //已删除，无成交的订单才能删除 Type: number Source: futuquant.mjs, line 334 OrderType 订单类型 OrderType_Unknown = 0; //未知类型 OrderType_Normal = 1; //普通订单(港股的增强限价单、A股的限价委托、美股的限价单) OrderType_Market = 2; //市价订单(目前仅美股) OrderType_AbsoluteLimit = 5; //绝对限价订单(目前仅港股)，只有价格完全匹配才成交，比如你下价格为5元的买单，卖单价格必须也要是5元才能成交，低于5元也不能成交。卖出同理 OrderType_Auction = 6; //竞价订单(目前仅港股)，A股的早盘竞价订单类型不变还是OrderType_Normal OrderType_AuctionLimit = 7; //竞价限价订单(目前仅港股) OrderType_SpecialLimit = 8; //特别限价订单(目前仅港股)，成交规则同OrderType_AbsoluteLimit，且如果当前没有对手可成交，不能立即成交，交易所自动撤销订单 Type: number Source: futuquant.mjs, line 322 PacketID 请求包标识，包的唯一标识，用于回放攻击的识别和保护 PacketID 用于唯一标识一次请求 serailNO 由请求方自定义填入包头，为防回放攻击要求自增，否则新的请求将被忽略 Type: object Properties: Name Type Description connID number 当前TCP连接的连接ID，一条连接的唯一标识，InitConnect协议会返回 serialNo number 包头中的包自增序列号 Source: futuquant.mjs, line 22 PlateInfo PlateInfo Properties: Name Type Description plate Security 板块 name string 板块名字 Source: futuquant.mjs, line 1172 PlateSetType 板块集合的类型 Qot_GetPlateSet 请求参数类型 PlateSetType_All = 0; //所有板块 PlateSetType_Industry = 1; //行业板块 PlateSetType_Region = 2; //地域板块,港美股市场的地域分类数据暂为空 PlateSetType_Concept = 3; //概念板块 Type: number Source: futuquant.mjs, line 64 Position 账户持仓结构 Type: object Properties: Name Type Argument Description positionID number 持仓ID，一条持仓的唯一标识 positionSide PositionSide 持仓方向，参见PositionSide的枚举定义 code string 代码 name string 名称 qty number 持有数量，2位精度，期权单位是&quot;张&quot;，下同 canSellQty number 可卖数量 price number 市价，3位精度(A股2位) costPrice number &lt;optional&gt; 成本价，无精度限制，如果没传，代表此时此值无效 val number 市值，3位精度(A股2位) plVal number 盈亏金额，3位精度(A股2位) plRatio number &lt;optional&gt; 盈亏比例，无精度限制，如果没传，代表此时此值无效 td_plVal number &lt;optional&gt; 今日盈亏金额，3位精度(A股2位)，下同 td_trdVal number &lt;optional&gt; 今日交易额 td_buyVal number &lt;optional&gt; 今日买入总额 td_buyQty number &lt;optional&gt; 今日买入总量 td_sellVal number &lt;optional&gt; 今日卖出总额 td_sellQty number &lt;optional&gt; 今日卖出总量 Source: futuquant.mjs, line 407 PositionSide 持仓方向类型 PositionSide_Long = 0; //多仓，默认情况是多仓 PositionSide_Unknown = -1; //未知方向 PositionSide_Short = 1; //空仓 Type: number Source: futuquant.mjs, line 355 QotGetBrokerResponse Qot_GetBroker.proto协议返回对象 Properties: Name Type Description security Security 股票 brokerAskList Array.&lt;Broker&gt; 经纪Ask(卖)盘 brokerBidList Array.&lt;Broker&gt; 经纪Bid(买)盘 Source: futuquant.mjs, line 860 QotGetHistoryKLPointsResponse Qot_GetHistoryKLPoints.proto协议返回对象 Properties: Name Type Description klPointList Array.&lt;SecurityHistoryKLPoints&gt; 多只股票的多点历史K线点 hasNext boolean 如请求不指定maxReqSecurityNum值，则不会返回该字段，该字段表示请求是否还有超过指定限制的数据 Source: futuquant.mjs, line 962 QotGetHistoryKLResponse Qot_GetHistoryKL.proto协议返回对象 Properties: Name Type Description security Security 股票 klList Array.&lt;KLine&gt; K线数据 nextKLTime string 如请求不指定maxAckKLNum值，则不会返回该字段，该字段表示超过指定限制的下一K线时间字符串 Source: futuquant.mjs, line 899 QotGetOrderBookResponse Qot_GetOrderBook.proto协议返回对象 Properties: Name Type Description security Security 股票 orderBookAskList Array.&lt;OrderBook&gt; 卖盘 orderBookBidList Array.&lt;OrderBook&gt; 买盘 Source: futuquant.mjs, line 817 QotGetRTResponse Qot_GetRT.proto协议返回对象 Properties: Name Type Description security Security 股票 rtList Array.&lt;TimeShare&gt; 分时点 Source: futuquant.mjs, line 758 QotGetSubInfoResponse Qot_GetSubInfo.proto协议返回对象 Properties: Name Type Description connSubInfoList Array.&lt;ConnSubInfo&gt; 订阅信息 totalUsedQuota number FutuOpenD已使用的订阅额度 remainQuota number FutuOpenD剩余订阅额度 Source: futuquant.mjs, line 675 QotGetTickerResponse Qot_GetTicker.proto协议返回对象 Properties: Name Type Description security Security 股票 tickerList Array.&lt;Ticker&gt; 逐笔 Source: futuquant.mjs, line 784 QotMarket 行情市场 QotMarket定义一支证券所属的行情市场分类 QotMarket_HK_Future 港股期货，目前仅支持 999010(恒指当月期货)、999011(恒指下月期货) QotMarket_US_Option 美股期权，牛牛客户端可以查看行情，API 后续支持 QotMarket_Unknown = 0; //未知市场 QotMarket_HK_Security = 1; //港股 QotMarket_HK_Future = 2; //港期货(目前是恒指的当月、下月期货行情) QotMarket_US_Security = 11; //美股 QotMarket_US_Option = 12; //美期权,暂时不支持期权 QotMarket_CNSH_Security = 21; //沪股 QotMarket_CNSZ_Security = 22; //深股 Type: number Source: futuquant.mjs, line 32 QotMarketState 行情市场状态 QotMarketState_None = 0; // 无交易,美股未开盘 QotMarketState_Auction = 1; // 竞价 QotMarketState_WaitingOpen = 2; // 早盘前等待开盘 QotMarketState_Morning = 3; // 早盘 QotMarketState_Rest = 4; // 午间休市 QotMarketState_Afternoon = 5; // 午盘 QotMarketState_Closed = 6; // 收盘 QotMarketState_PreMarketBegin = 8; // 盘前 QotMarketState_PreMarketEnd = 9; // 盘前结束 QotMarketState_AfterHoursBegin = 10; // 盘后 QotMarketState_AfterHoursEnd = 11; // 盘后结束 QotMarketState_NightOpen = 13; // 夜市开盘 QotMarketState_NightEnd = 14; // 夜市收盘 QotMarketState_FutureDayOpen = 15; // 期指日市开盘 QotMarketState_FutureDayBreak = 16; // 期指日市休市 QotMarketState_FutureDayClose = 17; // 期指日市收盘 QotMarketState_FutureDayWaitForOpen = 18; // 期指日市等待开盘 QotMarketState_HkCas = 19; // 盘后竞价,港股市场增加CAS机制对应的市场状态 Type: number Source: futuquant.mjs, line 85 QotUpdateKLResponse Qot_UpdateKL.proto协议返回对象 Properties: Name Type Description rehabType RehabType Qot_Common.RehabType,复权类型 klType KLType Qot_Common.KLType,K线类型 security Security 股票 klList Array.&lt;KLine&gt; 推送的k线点 Source: futuquant.mjs, line 741 ReconfirmOrderReason 需要再次确认订单的原因枚举 ReconfirmOrderReason_Unknown = 0; //未知原因 ReconfirmOrderReason_QtyTooLarge = 1; //订单数量太大，确认继续下单并否拆分成多个小订单 ReconfirmOrderReason_PriceAbnormal = 2; //价格异常，偏离当前价太大，确认继续下单 Type: number Source: futuquant.mjs, line 374 Rehab 复权信息 Properties: Name Type Argument Description time string 时间字符串 companyActFlag CompanyAct 公司行动组合,指定某些字段值是否有效 fwdFactorA number 前复权因子A fwdFactorB number 前复权因子B bwdFactorA number 后复权因子A bwdFactorB number 后复权因子B splitBase number &lt;optional&gt; 拆股(eg.1拆5，Base为1，Ert为5) splitErt number &lt;optional&gt; joinBase number &lt;optional&gt; 合股(eg.50合1，Base为50，Ert为1) joinErt number &lt;optional&gt; bonusBase number &lt;optional&gt; 送股(eg.10送3, Base为10,Ert为3) bonusErt number &lt;optional&gt; transferBase number &lt;optional&gt; 转赠股(eg.10转3, Base为10,Ert为3) transferErt number &lt;optional&gt; allotBase number &lt;optional&gt; 配股(eg.10送2, 配股价为6.3元, Base为10, Ert为2, Price为6.3) allotErt number &lt;optional&gt; allotPrice number &lt;optional&gt; addBase number &lt;optional&gt; 增发股(eg.10送2, 增发股价为6.3元, Base为10, Ert为2, Price为6.3) addErt number &lt;optional&gt; addPrice number &lt;optional&gt; dividend number &lt;optional&gt; 现金分红(eg.每10股派现0.5元,则该字段值为0.05) spDividend number &lt;optional&gt; 特别股息(eg.每10股派特别股息0.5元,则该字段值为0.05) Source: futuquant.mjs, line 1013 RehabType 复权类型 RehabType_None = 0; //不复权 RehabType_Forward = 1; //前复权 RehabType_Backward = 2; //后复权 Type: number Source: futuquant.mjs, line 108 RetType 协议返回值 RetType 定义协议请求返回值 请求失败情况，除网络超时外，其它具体原因参见各协议定义的retMsg字段 RetType_Succeed = 0; //成功 RetType_Failed = -1; //失败 RetType_TimeOut = -100; //超时 RetType_Unknown = -400; //未知结果 Type: number Source: futuquant.mjs, line 10 Security 股票，两个字段确定一支股票 Type: object Properties: Name Type Description market QotMarket QotMarket,股票市场 code string 股票代码 Source: futuquant.mjs, line 180 SecurityHistoryKLPoints 多只股票的多点历史K线点 Properties: Name Type Description security Security 股票 klList HistoryPointsKL K线数据 Source: futuquant.mjs, line 955 SecurityRehab 股票复权信息 Properties: Name Type Description security Security 股票 rehabList Array.&lt;Rehab&gt; 复权信息 Source: futuquant.mjs, line 1040 SecurityStaticBasic 证券基本静态信息 Type: object Properties: Name Type Description security security 股票 id number 股票ID lotSize number 每手数量 secType SecurityType Qot_Common.SecurityType,股票类型 name string 股票名字 listTime string 上市时间字符串 Source: futuquant.mjs, line 232 SecurityStaticInfo 证券静态信息 Type: object Properties: Name Type Argument Description basic SecurityStaticBasic 基本股票静态信息 warrantExData WarrantStaticExData &lt;optional&gt; 窝轮额外股票静态信息 Source: futuquant.mjs, line 248 SecurityType 股票类型 SecurityType_Unknown = 0; //未知 SecurityType_Bond = 1; //债券 SecurityType_Bwrt = 2; //一揽子权证 SecurityType_Eqty = 3; //正股 SecurityType_Trust = 4; //信托,基金 SecurityType_Warrant = 5; //涡轮 SecurityType_Index = 6; //指数 SecurityType_Plate = 7; //板块 SecurityType_Drvt = 8; //期权 SecurityType_PlateSet = 9; //板块集 Type: number Source: futuquant.mjs, line 49 Snapshot 快照 Properties: Name Type Argument Description basic SnapshotBasicData 快照基本数据 equityExData EquitySnapshotExData &lt;optional&gt; 正股快照额外数据 warrantExData WarrantSnapshotExData &lt;optional&gt; 窝轮快照额外数据 Source: futuquant.mjs, line 1143 SnapshotBasicData 基本快照数据 Properties: Name Type Description security Security 股票 type SecurityType Qot_Common.SecurityType,股票类型 isSuspend boolean 是否停牌 listTime string 上市时间字符串 lotSize number 每手数量 priceSpread number 价差 updateTime string 更新时间字符串 highPrice number 最新价 openPrice number 开盘价 lowPrice number 最低价 lastClosePrice number 昨收价 curPrice number 最新价 volume number 成交量 turnover number 成交额 turnoverRate number 换手率 Source: futuquant.mjs, line 1124 SubInfo 单个定阅类型信息 Type: object Properties: Name Type Description subType SubType Qot_Common.SubType,订阅类型 securityList Array.&lt;Security&gt; 订阅该类型行情的股票 Source: futuquant.mjs, line 279 SubType 行情定阅类型，订阅类型，枚举值兼容旧协议定义 SubType_None = 0; SubType_Basic = 1; //基础报价 SubType_OrderBook = 2; //摆盘 SubType_Ticker = 4; //逐笔 SubType_RT = 5; //分时 SubType_KL_Day = 6; //日K SubType_KL_5Min = 7; //5分K SubType_KL_15Min = 8; //15分K SubType_KL_30Min = 9; //30分K SubType_KL_60Min = 10; //60分K SubType_KL_1Min = 11; //1分K SubType_KL_Week = 12; //周K SubType_KL_Month = 13; //月K SubType_Broker = 14; //经纪队列 SubType_KL_Qurater = 15; //季K SubType_KL_Year = 16; //年K SubType_KL_3Min = 17; //3分K Type: number Source: futuquant.mjs, line 149 Ticker 逐笔成交 Type: object Properties: Name Type Argument Description time string 时间字符串 sequence number 唯一标识 dir TickerDirection TickerDirection, 买卖方向 price number 价格 volume number 成交量 turnover number 成交额 recvTime number &lt;optional&gt; 收到推送数据的本地时间戳，用于定位延迟 Source: futuquant.mjs, line 261 TickerDirection 逐笔方向 TickerDirection_Unknown = 0; //未知 TickerDirection_Bid = 1; //外盘 TickerDirection_Ask = 2; //内盘 TickerDirection_Neutral = 3; //中性盘 Type: number Source: futuquant.mjs, line 171 TimeShare 分时数据点 Type: object Properties: Name Type Argument Description time string 时间字符串 minute number 距离0点过了多少分钟 isBlank boolean 是否是空内容的点,若为ture则只有时间信息 price number &lt;optional&gt; 当前价 lastClosePrice number &lt;optional&gt; 昨收价 avgPrice number &lt;optional&gt; 均价 volume number &lt;optional&gt; 成交量 turnover number &lt;optional&gt; 成交额 Source: futuquant.mjs, line 220 TradeDate TradeDate Properties: Name Type Description time string 时间字符串 Source: futuquant.mjs, line 1058 TrdAcc 交易业务账户结构 Type: object Properties: Name Type Description trdEnv TrdEnv 交易环境, 参见TrdEnv的枚举定义 accID number 业务账号, 业务账号与交易环境、市场权限需要匹配，否则会返回错误 trdMarketAuthList TrdMarket 业务账户支持的交易市场权限，即此账户能交易那些市场, 可拥有多个交易市场权限，目前仅单个，取值参见TrdMarket的枚举定义 Source: futuquant.mjs, line 389 TrdEnv 交易环境 TrdEnv_Simulate = 0; //仿真环境(模拟环境) TrdEnv_Real = 1; //真实环境 Type: number Source: futuquant.mjs, line 295 TrdFilterConditions 过滤条件，条件组合是&quot;与&quot;不是&quot;或&quot;，用于获取订单、成交、持仓等时二次过滤 Type: object Properties: Name Type Argument Description codeList Array.&lt;string&gt; 代码过滤，只返回包含这些代码的数据，没传不过滤 idList Array.&lt;number&gt; ID主键过滤，只返回包含这些ID的数据，没传不过滤，订单是orderID、成交是fillID、持仓是positionID beginTime string &lt;optional&gt; 开始时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传，对持仓无效，拉历史数据必须填 endTime string &lt;optional&gt; 结束时间，严格按YYYY-MM-DD HH:MM:SS或YYYY-MM-DD HH:MM:SS.MS格式传，对持仓无效，拉历史数据必须填 Source: futuquant.mjs, line 462 TrdHeader 交易协议公共参数头 Type: object Properties: Name Type Description trdEnv TrdEnv 交易环境, 参见TrdEnv的枚举定义 accID number 业务账号, 业务账号与交易环境、市场权限需要匹配，否则会返回错误 trdMarket TrdMarket 交易市场, 参见TrdMarket的枚举定义 Source: futuquant.mjs, line 382 TrdMarket 交易市场，是大的市场，不是具体品种 TrdMarket_Unknown = 0; //未知市场 TrdMarket_HK = 1; //香港市场 TrdMarket_US = 2; //美国市场 TrdMarket_CN = 3; //大陆市场 TrdMarket_HKCC = 4; //香港A股通市场 Type: number Source: futuquant.mjs, line 302 TrdSide 交易方向，客户端下单只传Buy或Sell即可，SellShort是服务器返回有此方向，BuyBack目前不存在，但也不排除服务器会传 TrdSide_Unknown = 0; //未知方向 TrdSide_Buy = 1; //买入 TrdSide_Sell = 2; //卖出 TrdSide_SellShort = 3; //卖空 TrdSide_BuyBack = 4; //买回 Type: number Source: futuquant.mjs, line 312 WarrantSnapshotExData 涡轮类型额外数据 Properties: Name Type Description conversionRate number 换股比率 warrantType WarrantType Qot_Common.WarrantType,涡轮类型 strikePrice number 行使价 maturityTime string 到期日时间字符串 endTradeTime string 最后交易日时间字符串 owner Security 所属正股 recoveryPrice number 回收价 streetVolumn number 街货量 issueVolumn number 发行量 streetRate number 街货占比 delta number 对冲值 impliedVolatility number 引申波幅 premium number 溢价 Source: futuquant.mjs, line 1107 WarrantStaticExData 窝轮额外股票静态信息 Type: object Properties: Name Type Description type WarrantType Qot_Common.WarrantType,涡轮类型 owner Security 所属正股 Source: futuquant.mjs, line 242 WarrantType 窝轮子类型 WarrantType_Unknown = 0; //未知 WarrantType_Buy = 1; //认购 WarrantType_Sell = 2; //认沽 WarrantType_Bull = 3; //牛 WarrantType_Bear = 4; //熊 Type: number Source: futuquant.mjs, line 75 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result Classes Classes FutuQuant Socket × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result FutuQuant量化接口Nodejs版本基于FutuQuant v3.1.2底层协议封装的nodejs版本接口，数据格式使用protobuf，使用前请先在本地或者服务端启动FutuOpenD服务。 相关说明： 使用了ES6 modules，对应nodejs版本v8.5.0以上，启动时添加参数：--experimental-modules，参考：v8.5.0 proposal #15308。 最新版本使用了babel编译，可以直接使用require('futuquant')或者import FtQuant from 'futuquant'语法。 使用了async/await语法，要求nodejs版本v7.10.1以上，v7.5.1可以使用--harmony或者--harmony-async-await参数开启async/await的支持。 底层协议基于FutuQuant v3.1.2，参考：FutunnOpen/futuquant。 数据传输格式只支持protobuf。 API文档相关：https://yisbug.github.io/futuquant/doc/index.html 为了方便使用，请注意部分接口参数及返回结果和富途官方版本不完全一致，详细请参考API文档。 更新0.2.02017.07.27 fix: 优化自定义logger部分 feature: 修改qotGetBasicQot方法直接返回数组 feature: 修改qotGetOrderBook方法直接返回对象，并增加sellList和buyList两个字段，等同于orderBookAskList和orderBookBidList feature: 修改subQotUpdateOrderBook事件传递的摆盘结果，增加sellList和buyList两个字段，等同于orderBookAskList和orderBookBidList feature: 修改qotGetBroker方法返回结果，增加sellList和buyList两个字段，等同于brokerAskList和brokerBidList feature: 修改subQotUpdateBroker方法事件传递的经纪队列，增加sellList和buyList两个字段，等同于brokerAskList和brokerBidList feature: 修改qotGetStaticInfo返回结果，直接返回数组 feature: 修改qotGetSecuritySnapShot返回结果，直接返回数组，并支持超过200支以上股票的查询。 feature: 新增按市价下单接口：trdPlaceOrderMarket(param)，直到交易完成成功为止，返回买入/卖出总价 feature: 新增取消注册订单更新接口：unsubTrdUpdateOrder() docs: 其他调整 更多请点击查看更新日志 安装npm install futuquant --save或者 yarn add futuquant使用const FtQuant = require('./src/futuquant'); const fs = require('fs'); const bunyan = require('bunyan'); const bunyanDebugStream = require('bunyan-debug-stream'); const path = require('path'); const FILENAME = typeof __filename !== 'undefined' ? __filename : (/^ +at (?:file:\\/*(?=\\/)|)(.*?):\\d+:\\d+$/m.exec(Error().stack) || '')[1]; const DIRARR = FILENAME.split('/'); DIRARR.pop(); const DIRNAME = typeof __dirname !== 'undefined' ? __dirname : DIRARR.join('/'); const FutuOpenDXMLPath = path.join(DIRNAME, '../FutuOpenD_1.01_Mac/FutuOpenD.xml'); const ftOpenDConfig = fs.readFileSync(FutuOpenDXMLPath, { encoding: 'utf8' }); const userID = ftOpenDConfig.match(/login_account&gt;(\\d*?)&lt;\\/login_account/)[1]; const pwdMd5 = ftOpenDConfig.match(/trade_pwd_md5&gt;(.*?)&lt;\\/trade_pwd_md5/)[1]; // 自定义日志对象 const bunyanLogger = bunyan.createLogger({ name: 'sys', streams: [{ level: 'debug', type: 'raw', serializers: bunyanDebugStream.serializers, stream: bunyanDebugStream({ forceColor: true }), }], }); const ft = new FtQuant({ ip: '127.0.0.1', // FutuOpenD服务IP port: 11111, // FutuOpenD服务端口 userID, // 牛牛号 }, bunyanLogger); const init = async () =&gt; { let res = null; res = await ft.initConnect(); // 初始化连接 console.log('initConnect', res); res = await ft.getGlobalState(); // 获取全局状态 console.log('getGlobalState', res); await ft.trdUnlockTrade(true, pwdMd5); // 解锁交易密码 const accID = (await ft.trdGetAccList())[0].accID; await ft.setCommonTradeHeader(1, accID, 1); // 设置为港股的真实环境 }; init(); 测试请先修改test/futuquant.test.js中FutuOpenDXMLPath的路径，然后执行npm install或yarn安装相关依赖。 运行测试： npm test广告如有需要，请填写推荐人牛牛号：5894668，谢谢！ × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "},"FutuQuant.html":{"id":"FutuQuant.html","title":"Class: FutuQuant","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result Class: FutuQuant FutuQuant 封装FutuQuant底层协议模块 new FutuQuant(params [, logger]) Creates an instance of FutuQuant. Parameters: Name Type Argument Description params object 初始化参数 Properties Name Type Argument Description ip string FutuOpenD服务IP port number FutuOpenD服务端口 userID number 牛牛号 market TrdMarket &lt;optional&gt; 市场环境 logger object &lt;optional&gt; 日志对象，若不传入，则使用bunyan.createLogger创建 Source: futuquant.mjs, line 475 Members inited :boolean 是否已经初始化 Type: boolean Source: futuquant.mjs, line 531 socket :Socket 实例化的socket对象 Type: Socket Source: futuquant.mjs, line 521 timerKeepLive :number 保持心跳定时器 Type: number Source: futuquant.mjs, line 541 trdHeader :TrdHeader 交易公共头部信息 Type: TrdHeader Source: futuquant.mjs, line 536 userID :number 牛牛号 Type: number Source: futuquant.mjs, line 526 Methods &lt;async&gt; getGlobalState() GetGlobalState.proto - 1002获取全局状态 Source: futuquant.mjs, line 609 Returns: Type GetGlobalStateResponse &lt;async&gt; initConnect(params) InitConnect.proto - 1001初始化连接 nodejs版本会根据返回的keepAliveInterval字段自动保持心跳连接，不再需要手动调用ft.keepLive()方法。 请求其它协议前必须等InitConnect协议先完成 若FutuOpenD配置了加密， “connAESKey”将用于后续协议加密 keepAliveInterval 为建议client发起心跳 KeepAlive 的间隔 Parameters: Name Type Description params object 初始化参数 Properties Name Type Description clientVer number 客户端版本号，clientVer = &quot;.&quot;以前的数 100 + &quot;.&quot;以后的，举例：1.1版本的clientVer为1 100 + 1 = 101，2.21版本为2 * 100 + 21 = 221 clientID string 客户端唯一标识，无生具体生成规则，客户端自己保证唯一性即可 recvNotify boolean 此连接是否接收市场状态、交易需要重新解锁等等事件通知，true代表接收，FutuOpenD就会向此连接推送这些通知，反之false代表不接收不推送 Source: futuquant.mjs, line 566 Returns: Type InitConnectResponse &lt;async&gt; keepAlive() KeepAlive.proto - 1004保活心跳 Source: futuquant.mjs, line 618 Returns: time 服务器回包时的格林威治时间戳，单位秒 Type number &lt;async&gt; qotGetBasicQot(securityList) Qot_GetBasicQot.proto - 3004获取股票基本行情 股票结构参考 Security 基本报价结构参考 BasicQot Parameters: Name Type Description securityList Array.&lt;Security&gt; 股票列表 Source: futuquant.mjs, line 702 Returns: basicQotList 股票基本报价 Type Array.&lt;BasicQot&gt; &lt;async&gt; qotGetBroker(security) Qot_GetBroker.proto - 3014获取经纪队列 Parameters: Name Type Description security Security Object 股票 Source: futuquant.mjs, line 873 Returns: Type QotGetBrokerResponse &lt;async&gt; qotGetHistoryKL(params) Qot_GetHistoryKL.proto - 3100获取单只股票一段历史K线 Parameters: Name Type Description params object Properties Name Type Argument Description rehabType RehabType Qot_Common.RehabType,复权类型 klType KLType Qot_Common.KLType,K线类型 security Security 股票市场以及股票代码 beginTime string 开始时间字符串 endTime string 结束时间字符串 maxAckKLNum number &lt;optional&gt; 最多返回多少根K线，如果未指定表示不限制 needKLFieldsFlag number &lt;optional&gt; 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 Source: futuquant.mjs, line 919 Returns: Type QotGetHistoryKLResponse &lt;async&gt; qotGetHistoryKLPoints(params) Qot_GetHistoryKLPoints.proto - 3101获取多只股票多点历史K线 复权类型参考 RehabType K线类型参考 KLType 股票结构参考 Security K线结构参考 KLine K线字段类型参考 KLFields 目前限制最多5个时间点，股票个数不做限制，但不建议传入过多股票，查询耗时过多会导致协议返回超时。 Parameters: Name Type Description params object Properties Name Type Argument Description rehabType RehabType Qot_Common.RehabType,复权类型 klType KLType Qot_Common.KLType,K线类型 noDataMode NoDataMode NoDataMode,当请求时间点数据为空时，如何返回数据 securityList Array.&lt;Security&gt; 股票市场以及股票代码 timeList Array.&lt;string&gt; 时间字符串 maxReqSecurityNum number &lt;optional&gt; 最多返回多少只股票的数据，如果未指定表示不限制 needKLFieldsFlag KLFields &lt;optional&gt; 指定返回K线结构体特定某几项数据，KLFields枚举值或组合，如果未指定返回全部字段 Source: futuquant.mjs, line 988 Returns: Type QotGetHistoryKLPointsResponse &lt;async&gt; qotGetKL(params) Qot_GetKL.proto - 3006获取K线 复权类型参考 RehabType K线类型参考 KLType 股票结构参考 Security K线结构参考 KLine 请求K线目前最多最近1000根 Parameters: Name Type Description params object Properties Name Type Description rehabType RehabType Qot_Common.RehabType,复权类型 klType KLType Qot_Common.KLType,K线类型 security Security 股票 reqNum number 请求K线根数 Source: futuquant.mjs, line 733 Returns: k线点 Type Array.&lt;KLine&gt; &lt;async&gt; qotGetOrderBook(security, num) Qot_GetOrderBook.proto - 3012获取买卖盘，需要先调用订阅接口 Parameters: Name Type Default Description security Security 股票 num number 10 请求的摆盘个数（1-10），默认10 Source: futuquant.mjs, line 831 Returns: Type QotGetOrderBookResponse &lt;async&gt; qotGetPlateSecurity(plate) Qot_GetPlateSecurity.proto - 3205获取板块下的股票 Parameters: Name Type Description plate Security 板块 Source: futuquant.mjs, line 1197 Returns: staticInfoList 板块下的股票静态信息 Type Array.&lt;SecurityStaticInfo&gt; &lt;async&gt; qotGetPlateSet(market, plateSetType) Qot_GetPlateSet.proto - 3204获取板块集合下的板块 Parameters: Name Type Default Description market QotMarket 1 Qot_Common.QotMarket,股票市场 plateSetType PlateSetType Qot_Common.PlateSetType,板块集合的类型 Source: futuquant.mjs, line 1185 Returns: plateInfoList 板块集合下的板块信息 Type Array.&lt;PlateInfo&gt; &lt;async&gt; qotGetRehab(securityList) Qot_GetRehab.proto - 3102获取复权信息 Parameters: Name Type Description securityList Array.&lt;Security&gt; 股票列表 Source: futuquant.mjs, line 1053 Returns: securityRehabList 多支股票的复权信息 Type Array.&lt;SecurityRehab&gt; &lt;async&gt; qotGetRT(security) Qot_GetRT.proto - 3008获取分时 Parameters: Name Type Description security Security 股票 Source: futuquant.mjs, line 770 Returns: Type QotGetRTResponse &lt;async&gt; qotGetSecuritySnapShot(securityList) Qot_GetSecuritySnapshot.proto - 3203获取股票快照 股票结构参考 Security 限频接口：30秒内最多10次 最多可传入200只股票 Parameters: Name Type Description securityList Array.&lt;Security&gt; 股票列表 Source: futuquant.mjs, line 1160 Returns: snapshotList 股票快照 Type Array.&lt;Snapshot&gt; &lt;async&gt; qotGetStaticInfo(market, secType) Qot_GetStaticInfo.proto - 3202获取股票静态信息 Parameters: Name Type Default Description market QotMarket 1 Qot_Common.QotMarket,股票市场 secType SecurityType Qot_Common.SecurityType,股票类型 Source: futuquant.mjs, line 1086 Returns: 静态信息数组 Type Array.&lt;SecurityStaticInfo&gt; &lt;async&gt; qotGetSubInfo( [isReqAllConn]) Qot_GetSubInfo.proto - 3003获取订阅信息 Parameters: Name Type Argument Default Description isReqAllConn boolean &lt;optional&gt; false 是否返回所有连接的订阅状态，默认false Source: futuquant.mjs, line 688 Returns: Type QotGetSubInfoResponse &lt;async&gt; qotGetTicker(security, maxRetNum) Qot_GetTicker.proto - 3010获取逐笔 股票结构参考 Security 逐笔结构参考 Ticker 请求逐笔目前最多最近1000个 Parameters: Name Type Default Description security Security 股票 maxRetNum number 100 最多返回的逐笔个数,实际返回数量不一定会返回这么多,最多返回1000个，默认100 Source: futuquant.mjs, line 801 Returns: Type QotGetTickerResponse &lt;async&gt; qotGetTradeDate(market, beginTime, endTime) Qot_GetTradeDate.proto - 3200获取市场交易日 Parameters: Name Type Default Description market QotMarket 1 Qot_Common.QotMarket,股票市场 beginTime string 2018-01-01 00:00:00 开始时间字符串 endTime string 2018-02-01 00:00:00 结束时间字符串 Source: futuquant.mjs, line 1072 Returns: tradeDateList 交易日 Type Array.&lt;TradeDate&gt; &lt;async&gt; qotRegQotPush(params) Qot_RegQotPush.proto - 3002注册行情推送 股票结构参考 Security 订阅数据类型参考 SubType 复权类型参考 RehabType 行情需要订阅成功才能注册推送 Parameters: Name Type Description params object Object Properties Name Type Argument Default Description securityList Array.&lt;Security&gt; 股票 subTypeList Array.&lt;SubType&gt; Qot_Common.SubType,订阅数据类型 rehabTypeList Array.&lt;SubType&gt; Qot_Common.RehabType,复权类型,注册K线类型才生效,其他订阅类型忽略该参数,注册K线时该参数不指定默认前复权 isRegOrUnReg boolean &lt;optional&gt; true 注册或取消 isFirstPush boolean &lt;optional&gt; true 注册后如果本地已有数据是否首推一次已存在数据,该参数不指定则默认true Source: futuquant.mjs, line 666 &lt;async&gt; qotSub(params) Qot_Sub.proto - 3001订阅或者反订阅 股票结构参考 Security 订阅数据类型参考 SubType 复权类型参考 RehabType 为控制定阅产生推送数据流量，股票定阅总量有额度控制，订阅规则参考 高频数据接口 高频数据接口需要订阅之后才能使用，注册推送之后才可以收到数据更新推送 Parameters: Name Type Description params object Properties Name Type Argument Default Description securityList Array.&lt;Security&gt; 股票 subTypeList Array.&lt;SubType&gt; Qot_Common.SubType,订阅数据类型 isSubOrUnSub boolean &lt;optional&gt; true ture表示订阅,false表示反订阅 isRegOrUnRegPush boolean &lt;optional&gt; true 是否注册或反注册该连接上面行情的推送,该参数不指定不做注册反注册操作 regPushRehabTypeList number Qot_Common.RehabType,复权类型,注册推送并且是K线类型才生效,其他订阅类型忽略该参数,注册K线推送时该参数不指定默认前复权 isFirstPush boolean &lt;optional&gt; true 注册后如果本地已有数据是否首推一次已存在数据,该参数不指定则默认true Source: futuquant.mjs, line 641 setCommonTradeHeader(trdEnv, accID [, trdMarket]) 设置交易模块的公共header，调用交易相关接口前必须先调用此接口。 Parameters: Name Type Argument Default Description trdEnv TrdEnv 交易环境, 参见TrdEnv的枚举定义。0为仿真，1为真实，默认为1。 accID number 业务账号, 业务账号与交易环境、市场权限需要匹配，否则会返回错误，默认为当前userID trdMarket TrdMarket &lt;optional&gt; 1 交易市场, 参见TrdMarket的枚举定义，默认为1，即香港市场。 Source: futuquant.mjs, line 1256 &lt;async&gt; subQotUpdateBasicQot(callback) 注册股票基本报价通知，需要先调用订阅接口 Qot_UpdateBasicQot.proto - 3005推送股票基本报价 Parameters: Name Type Description callback function 回调 Source: futuquant.mjs, line 714 Returns: basicQotList Type Array.&lt;BasicQot&gt; &lt;async&gt; subQotUpdateBroker(callback) 注册经纪队列推送，需要先调用订阅接口 Qot_UpdateBroker.proto - 3015推送经纪队列 Parameters: Name Type Description callback function 回调 Source: futuquant.mjs, line 890 Returns: Type QotGetBrokerResponse &lt;async&gt; subQotUpdateKL() 注册K线推送，需要先调用订阅接口 Qot_UpdateKL.proto - 3007推送K线 Source: futuquant.mjs, line 755 Returns: 推送的k线点 Type Array.&lt;KLine&gt; &lt;async&gt; subQotUpdateRT() 注册分时推送，需要先调用订阅接口 Qot_UpdateRT.proto - 3009推送分时 Source: futuquant.mjs, line 781 Returns: Type QotGetRTResponse &lt;async&gt; subQotUpdateTicker(callback) 注册逐笔推送，需要先调用订阅接口 Qot_UpdateTicker.proto - 3011推送逐笔 Parameters: Name Type Description callback function 回调 Source: futuquant.mjs, line 814 Returns: Type QotGetTickerResponse &lt;async&gt; subTrdUpdateOrder(callback) 注册订单更新通知 Trd_UpdateOrder.proto - 2208推送订单更新 Parameters: Name Type Description callback function 回调 Source: futuquant.mjs, line 1448 Returns: 订单结构 Type Order &lt;async&gt; subTrdUpdateOrderFill(callback) 注册新成交通知 Trd_UpdateOrderFill.proto - 2218推送新成交 Parameters: Name Type Description callback function 回调 Source: futuquant.mjs, line 1478 Returns: 成交结构 Type OrderFill &lt;async&gt; trdGetAccList(userID [, market]) Trd_GetAccList.proto - 2001获取交易账户列表 Parameters: Name Type Argument Default Description userID number 需要跟FutuOpenD登陆的牛牛用户ID一致，否则会返回失败 market QotMarket &lt;optional&gt; 1 Qot_Common.QotMarket,股票市场 Source: futuquant.mjs, line 1209 Returns: 交易业务账户列表 Type Array.&lt;TrdAcc&gt; &lt;async&gt; trdGetFunds() Trd_GetFunds.proto - 2101获取账户资金，需要先设置交易模块公共header Source: futuquant.mjs, line 1268 Returns: Type Funds &lt;async&gt; trdGetHistoryOrderFillList(filterConditions) Trd_GetHistoryOrderFillList.proto - 2222获取历史成交列表 交易公共参数头结构参考 TrdHeader 成交结构参考 OrderFill 过滤条件结构参考 TrdFilterConditions 限频接口：30秒内最多10次 Parameters: Name Type Description filterConditions TrdFilterConditions 过滤条件 Source: futuquant.mjs, line 1513 Returns: 历史成交列表 Type Array.&lt;OrderFill&gt; &lt;async&gt; trdGetHistoryOrderList(filterConditions, filterStatusList) Trd_GetHistoryOrderList.proto - 2221获取历史订单列表 交易公共参数头结构参考 TrdHeader 订单结构参考 Order 过滤条件结构参考 TrdFilterConditions 订单状态枚举参考 OrderStatus 限频接口：30秒内最多10次 Parameters: Name Type Description filterConditions TrdFilterConditions 过滤条件 filterStatusList OrderStatus OrderStatus, 需要过滤的订单状态列表 Source: futuquant.mjs, line 1494 Returns: 历史订单列表 Type Array.&lt;Order&gt; &lt;async&gt; trdGetOrderFillList(filterConditions) Trd_GetOrderFillList.proto - 2211获取成交列表 Parameters: Name Type Description filterConditions TrdFilterConditions 过滤条件 Source: futuquant.mjs, line 1465 Returns: 成交列表 Type Array.&lt;OrderFill&gt; &lt;async&gt; trdGetOrderList(filterConditions, filterStatusList) Trd_GetOrderList.proto - 2201获取订单列表 Parameters: Name Type Description filterConditions TrdFilterConditions 过滤条件 filterStatusList Array.&lt;OrderStatus&gt; 需要过滤的订单状态列表 Source: futuquant.mjs, line 1298 Returns: 订单列表 Type Array.&lt;Order&gt; &lt;async&gt; trdGetPositionList(filterConditions, filterPLRatioMin, filterPLRatioMax) Trd_GetPositionList.proto - 2102获取持仓列表 Parameters: Name Type Description filterConditions TrdFilterConditions 过滤条件 filterPLRatioMin number 过滤盈亏比例下限，高于此比例的会返回，如0.1，返回盈亏比例大于10%的持仓 filterPLRatioMax number 过滤盈亏比例上限，低于此比例的会返回，如0.2，返回盈亏比例小于20%的持仓 Source: futuquant.mjs, line 1282 Returns: 持仓列表数组 Type Array.&lt;Position&gt; &lt;async&gt; trdModifyOrder(params) Trd_ModifyOrder.proto - 2205修改订单(改价、改量、改状态等) 请求包标识结构参考 PacketID 交易公共参数头结构参考 TrdHeader 修改操作枚举参考 ModifyOrderOp 限频接口：30秒内最多30次 Parameters: Name Type Description params object Properties Name Type Argument Description packetID PacketID &lt;optional&gt; 交易写操作防重放攻击，默认不用填写 header TrdHeader &lt;optional&gt; 交易公共参数头，默认不用填写 orderID number 订单号，forAll为true时，传0 modifyOrderOp ModifyOrderOp 修改操作类型，参见Trd_Common.ModifyOrderOp的枚举定义 forAll boolean &lt;optional&gt; 是否对此业务账户的全部订单操作，true是，false否(对单个订单)，无此字段代表false，仅对单个订单 下面的字段仅在modifyOrderOp为ModifyOrderOp_Normal有效 qty number &lt;optional&gt; 数量，2位精度，期权单位是&quot;张&quot; price number &lt;optional&gt; 价格，3位精度(A股2位) 以下为调整价格使用，目前仅对港、A股有效，因为港股有价位，A股2位精度，美股不需要 adjustPrice boolean &lt;optional&gt; 是否调整价格，如果价格不合法，是否调整到合法价位，true调整，false不调整 adjustSideAndLimit number &lt;optional&gt; 调整方向和调整幅度百分比限制，正数代表向上调整，负数代表向下调整，具体值代表调整幅度限制，如：0.015代表向上调整且幅度不超过1.5%；-0.01代表向下调整且幅度不超过1% Source: futuquant.mjs, line 1423 Returns: orderID 订单号 Type number &lt;async&gt; trdPlaceOrder(params) Trd_PlaceOrder.proto - 2202下单 请求包标识结构参考 PacketID 交易公共参数头结构参考 TrdHeader 交易方向枚举参考 TrdSide 订单类型枚举参考 OrderType 限频接口：30秒内最多30次 Parameters: Name Type Description params object Properties Name Type Argument Description packetID PacketID &lt;optional&gt; 交易写操作防重放攻击，默认不用填写 header TrdHeader &lt;optional&gt; 交易公共参数头，默认不用填写 trdSide TrdSide 交易方向, 参见Trd_Common.TrdSide的枚举定义 orderType OrderType 订单类型, 参见Trd_Common.OrderType的枚举定义 code string 代码 qty number 数量，2位精度，期权单位是&quot;张&quot; price number &lt;optional&gt; 价格，3位精度(A股2位) 以下为调整价格使用，目前仅对港、A股有效，因为港股有价位，A股2位精度，美股不需要 adjustPrice boolean &lt;optional&gt; 是否调整价格，如果价格不合法，是否调整到合法价位，true调整，false不调整 adjustSideAndLimit number &lt;optional&gt; 调整方向和调整幅度百分比限制，正数代表向上调整，负数代表向下调整，具体值代表调整幅度限制，如：0.015代表向上调整且幅度不超过1.5%；-0.01代表向下调整且幅度不超过1% Source: futuquant.mjs, line 1328 Returns: orderID 订单号 Type number &lt;async&gt; trdPlaceOrderMarket(param) 2202市价下单，直到成功为止，返回买入/卖出的总价格 Parameters: Name Type Description param object params.trdSide TrdSide 交易方向, 参见Trd_Common.TrdSide的枚举定义 params.code string 代码 params.qty number 数量，2位精度，期权单位是&quot;张&quot; Source: futuquant.mjs, line 1356 Returns: 卖出/买入总价 Type number &lt;async&gt; trdSubAccPush(accIDList) Trd_SubAccPush.proto - 2008订阅接收交易账户的推送数据 Parameters: Name Type Description accIDList Array.&lt;number&gt; 要接收推送数据的业务账号列表，全量非增量，即使用者请每次传需要接收推送数据的所有业务账号 Source: futuquant.mjs, line 1245 &lt;async&gt; trdUnlockTrade( [unlock] [, pwdMD5]) Trd_UnlockTrade.proto - 2005解锁或锁定交易 除2001协议外，所有交易协议请求都需要FutuOpenD先解锁交易 密码MD5方式获取请参考 FutuOpenD配置 内的login_pwd_md5字段 解锁或锁定交易针对与FutuOpenD，只要有一个连接解锁，其他连接都可以调用交易接口 强烈建议有实盘交易的用户使用加密通道，参考 加密通信流程 限频接口：30秒内最多10次 Parameters: Name Type Argument Default Description unlock boolean &lt;optional&gt; true true解锁交易，false锁定交易，默认true pwdMD5 string &lt;optional&gt; 交易密码的MD5转16进制(全小写)，解锁交易必须要填密码，锁定交易不需要验证密码，可不填 Source: futuquant.mjs, line 1233 &lt;async&gt; unsubTrdUpdateOrder() 取消注册订单更新通知 Trd_UpdateOrder.proto - 2208推送订单更新 Source: futuquant.mjs, line 1456 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "},"Socket.html":{"id":"Socket.html","title":"Class: Socket","body":" FutuQuant-Nodejs Classes FutuQuantSocket Global result Class: Socket Socket Socket模块 new Socket(ip, port, logger) Creates an instance of Socket. Parameters: Name Type Description ip string OpenD服务Ip port number OpenD服务端口 logger object 日志对象 Source: socket.mjs, line 27 Members id :number socket id，自增，用于区分多个socket。 Type: number Source: socket.mjs, line 56 ip :string OpenD服务IP Type: string Source: socket.mjs, line 39 isConnect :boolean socket是否已经连接 Type: boolean Source: socket.mjs, line 66 logger :object 日志对象 Type: object Source: socket.mjs, line 49 name :string socket名称，用于区分多个socket。 Type: string Source: socket.mjs, line 61 port :number OpenD服务端口 Type: number Source: socket.mjs, line 44 requestId :number 请求序列号，自增 Type: number Source: socket.mjs, line 71 Methods &lt;async&gt; connect() 立即建立连接 Source: socket.mjs, line 116 onConnect(cb) 设置连接成功的回调函数 Parameters: Name Type Description cb function Source: socket.mjs, line 140 parseData() 解析包体数据 Source: socket.mjs, line 214 &lt;async&gt; send(protoName, message) 发送数据 Parameters: Name Type Description protoName string 协议名称 message object 要发送的数据 Source: socket.mjs, line 168 subNotify(protoId, callback) 注册协议的通知 Parameters: Name Type Description protoId number 协议id callback function 回调函数 Source: socket.mjs, line 149 unsubNotify(protoId) 删除一个通知 Parameters: Name Type Description protoId number 协议id Source: socket.mjs, line 156 × Search results Close Documentation generated by JSDoc 3.5.5 on 2018-07-31T23:30:17+08:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
